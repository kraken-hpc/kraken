(this["webpackJsonpkraken-dashboard"]=this["webpackJsonpkraken-dashboard"]||[]).push([[0],{111:function(e,t,o){e.exports=o(290)},116:function(e,t,o){},117:function(e,t,o){},118:function(e,t,o){},119:function(e,t,o){},120:function(e,t,o){},121:function(e,t,o){},127:function(e,t,o){},290:function(e,t,o){"use strict";o.r(t);var n=o(0),a=o.n(n),r=o(107),c=o.n(r),s=(o(71),o(2)),l=o(7),i=o(16),d=o(9),u=o(8),p=o(10),f=(o(116),o(117),o(118),o(119),o(120),o(121),"192.168.57.10:3141"),g=.4,h=!0,v="/dsc/nodes",m="/cfg/nodes",C="/ws",N="/enumerables",E=function(e){return"/graph/node/".concat(e,"/json")},b={red:window.getComputedStyle(document.documentElement).getPropertyValue("--red"),purple:window.getComputedStyle(document.documentElement).getPropertyValue("--purple"),grey:window.getComputedStyle(document.documentElement).getPropertyValue("--grey"),yellow:window.getComputedStyle(document.documentElement).getPropertyValue("--yellow"),blue:window.getComputedStyle(document.documentElement).getPropertyValue("--blue"),green:window.getComputedStyle(document.documentElement).getPropertyValue("--green"),black:window.getComputedStyle(document.documentElement).getPropertyValue("--black"),titleRed:window.getComputedStyle(document.documentElement).getPropertyValue("--title-red"),borderGrey:window.getComputedStyle(document.documentElement).getPropertyValue("--border-grey"),lightGrey:window.getComputedStyle(document.documentElement).getPropertyValue("--light-grey")},S={TOP:{category:"PhysState",DSCorCFG:"DSC",valuesToColor:new Map([["POWER_ON",{enum:2,color:b.green}],["PHYS_UNKNOWN",{enum:0,color:b.yellow}],["POWER_OFF",{enum:1,color:b.grey}],["POWER_CYCLE",{enum:3,color:b.purple}],["PHYS_HANG",{enum:4,color:b.purple}],["PHYS_ERROR",{enum:5,color:b.red}]])},RIGHT:{category:"RunState",DSCorCFG:"DSC",valuesToColor:new Map([["INIT",{enum:1,color:b.blue}],["UNKNOWN",{enum:0,color:b.yellow}],["SYNC",{enum:2,color:b.green}],["ERROR",{enum:3,color:b.red}]])},LEFT:{category:"PhysState",DSCorCFG:"DSC",valuesToColor:new Map([["POWER_ON",{enum:2,color:b.green}],["PHYS_UNKNOWN",{enum:0,color:b.yellow}],["POWER_OFF",{enum:1,color:b.grey}],["POWER_CYCLE",{enum:3,color:b.purple}],["PHYS_HANG",{enum:4,color:b.purple}],["PHYS_ERROR",{enum:5,color:b.red}]])},BOTTOM:{category:"RunState",DSCorCFG:"DSC",valuesToColor:new Map([["INIT",{enum:1,color:b.blue}],["UNKNOWN",{enum:0,color:b.yellow}],["SYNC",{enum:2,color:b.green}],["ERROR",{enum:3,color:b.red}]])},BORDER:{category:"PhysState",DSCorCFG:"DSC",valuesToColor:new Map([["POWER_ON",{enum:2,color:b.green}],["PHYS_UNKNOWN",{enum:0,color:b.yellow}],["POWER_OFF",{enum:1,color:b.grey}],["POWER_CYCLE",{enum:3,color:b.purple}],["PHYS_HANG",{enum:4,color:b.purple}],["PHYS_ERROR",{enum:5,color:b.red}]])}},y=o(22),O=o(26);function k(e){return a.a.createElement("div",{className:"header"},a.a.createElement(y.b,{to:"/",className:"header-link"},a.a.createElement("div",{className:"header-text"},"Kraken")),a.a.createElement(T,{refreshRate:e.refreshRate,handleRefreshChange:e.handleRefreshChange,useWebSocket:e.useWebSocket,handleWebsocketChange:e.handleWebsocketChange,krakenIP:e.krakenIP,handleIpChange:e.handleIpChange}))}var T=function(e){function t(e){var o;return Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).buttonRef=null,o.closeMenu=function(){o.setState({menuOpen:!1})},o.state={menuOpen:!1},o}return Object(p.a)(t,e),Object(i.a)(t,[{key:"toggleMenu",value:function(){this.setState({menuOpen:!this.state.menuOpen})}},{key:"render",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement("svg",{ref:function(t){return e.buttonRef=t},onClick:function(){e.toggleMenu()},className:"settings",id:"settings-button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},a.a.createElement("path",{fill:"none",d:"M0 0h20v20H0V0z"}),a.a.createElement("path",{fill:b.titleRed,d:"M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"})),a.a.createElement(w,{buttonRef:this.buttonRef,menuOpen:this.state.menuOpen,refreshRate:this.props.refreshRate,handleRefreshChange:this.props.handleRefreshChange,useWebSocket:this.props.useWebSocket,handleWebsocketChange:this.props.handleWebsocketChange,closeMenu:this.closeMenu,krakenIP:this.props.krakenIP,handleIpChange:this.props.handleIpChange}))}}]),t}(a.a.Component),w=function(e){function t(e){var o;Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).modalRef=null,o.handleClick=function(e){null===o.modalRef||o.modalRef.contains(e.target)||null===o.props.buttonRef||o.props.buttonRef.contains(e.target)||o.props.closeMenu()};return o.state={openTop:"7rem",closedTop:"6rem",style:{opacity:o.props.menuOpen?100:0,visibility:o.props.menuOpen?"visible":"hidden",top:o.props.menuOpen?"7rem":"6rem"},ip:o.props.krakenIP},o}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){document.addEventListener("mousedown",this.handleClick,!1),e.menuOpen!==this.props.menuOpen&&this.setState({style:{opacity:this.props.menuOpen?100:0,visibility:this.props.menuOpen?"visible":"hidden",top:this.props.menuOpen?this.state.openTop:this.state.closedTop}})}},{key:"render",value:function(){var e=this;return a.a.createElement("form",{className:"settings",id:"settings-modal",style:this.state.style,ref:function(t){return e.modalRef=t}},a.a.createElement("div",{className:"settings-row"},a.a.createElement("label",null,"Kraken IP:"),a.a.createElement("input",{className:"ip-field",name:"krakenIP",type:"text",value:this.state.ip,onChange:function(t){e.setState({ip:t.target.value})}}),a.a.createElement("button",{id:"ip-apply-button",className:"button",disabled:this.props.krakenIP===this.state.ip,onClick:function(){e.props.handleIpChange(e.state.ip),e.props.closeMenu()}},"Apply")),a.a.createElement("div",{className:"settings-row"},a.a.createElement("label",null,"Reconnect Rate:"),a.a.createElement("input",{id:"slider",name:"refreshRate",type:"range",min:"0.15",max:"2",value:this.props.refreshRate,onChange:function(t){e.props.handleRefreshChange(parseFloat(t.target.value))},step:".05"}),a.a.createElement("div",{id:"slider-output"},this.props.refreshRate)),a.a.createElement("div",{className:"settings-row"},a.a.createElement("label",null,"Websocket:"),a.a.createElement("input",{style:{margin:"auto 7px"},name:"websocket",type:"checkbox",checked:this.props.useWebSocket,onChange:function(){e.props.handleWebsocketChange(!e.props.useWebSocket)}})),a.a.createElement("div",{className:"settings-row"},a.a.createElement(y.b,{to:"/settings",style:{textDecoration:"none"}},a.a.createElement("div",{onClick:this.props.closeMenu,id:"color-settings-button",className:"button"},"Color Settings"))))}}]),t}(a.a.Component),R=o(13),I=o(69),A=o(5),x=o.n(A),M=function(e){var t,o;return x.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x.a.awrap(fetch(e).catch((function(e){return null})));case 2:if(null===(t=n.sent)){n.next=10;break}return n.next=6,x.a.awrap(t.json());case 6:return o=n.sent,n.abrupt("return",o.nodes);case 10:return n.abrupt("return",null);case 11:case"end":return n.stop()}}))},P=function(e,t){var o,n,a,r,c,l;return x.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,x.a.awrap(Promise.all([fetch(e),fetch(t)]));case 2:if(o=i.sent,n=Object(s.a)(o,2),a=n[0],r=n[1],null!==a&&null!==r){i.next=10;break}return i.abrupt("return",null);case 10:return i.next=12,x.a.awrap(a.json());case 12:return c=i.sent,i.next=15,x.a.awrap(r.json());case 15:return l=i.sent,i.abrupt("return",[c.nodes,l.nodes]);case 17:case"end":return i.stop()}}))},F=function(e){var t;return x.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,x.a.awrap(fetch(e).catch((function(e){return null})));case 2:if(null===(t=o.sent)){o.next=7;break}return o.abrupt("return",t.json());case 7:return o.abrupt("return",null);case 8:case"end":return o.stop()}}))},j=function(e){var t,o,n,a,r;return x.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return t=new Map,o={},c.next=4,x.a.awrap(M(e));case 4:if(null!==(n=c.sent)){c.next=9;break}return c.abrupt("return",{masterNode:null,computeNodes:null});case 9:for(a=0;a<n.length;a++)null===n[a].parentId||void 0===n[a].parentId?o=n[a]:void 0!==(r=n[a].id)&&t.set(r,n[a]);case 10:return c.abrupt("return",{masterNode:o,computeNodes:t});case 11:case"end":return c.stop()}}))},W=function(e,t){var o,n,a,r,c;return x.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return o=new Map,n={},s.next=4,x.a.awrap(M(e));case 4:if(null!==(a=s.sent)){s.next=9;break}return s.abrupt("return",{masterNode:null,computeNodes:null});case 9:for(r=0;r<a.length;r++)a[r].id===t?n=a[r]:void 0!==(c=a[r].id)&&o.set(c,a[r]);case 10:return s.abrupt("return",{masterNode:n,computeNodes:o});case 11:case"end":return s.stop()}}))},G=function(e,t){var o,n,a,r,c,s,l,i,d,u,p;return x.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,x.a.awrap(P(e,t));case 2:if(null===(o=f.sent)){f.next=15;break}for(n=o[0],a=o[1],r={},c={},s=new Map,l=new Map,i=0;i<n.length;i++)null===n[i].parentId||void 0===n[i].parentId?r=n[i]:void 0!==(d=n[i].id)&&s.set(d,n[i]);for(u=0;u<a.length;u++)a[u].id===r.id?c=a[u]:void 0!==(p=a[u].id)&&l.set(p,a[u]);return f.abrupt("return",{cfgMasterNode:r,cfgComputeNodes:s,dscMasterNode:c,dscComputeNodes:l});case 15:return f.abrupt("return",{cfgMasterNode:null,cfgComputeNodes:null,dscMasterNode:null,dscComputeNodes:null});case 16:case"end":return f.stop()}}))},D=function(e,t){if(void 0===e.nodename&&void 0===t.nodename)return 0;if(void 0===e.nodename)return-1;if(void 0===t.nodename)return 1;var o=e.nodename.match(/(\d*)/g),n=t.nodename.match(/(\d*)/g),a=void 0,r=void 0,c=void 0,s=void 0;return null!==o&&(a=parseInt(o[1]),r=parseInt(o[3])),null!==n&&(c=parseInt(n[1]),s=parseInt(n[3])),void 0!==a&&void 0!==c&&a>c?1:void 0!==a&&void 0!==c&&a<c?-1:void 0!==r&&void 0!==s&&r>s?1:void 0!==r&&void 0!==s&&r<s?-1:e.nodename.localeCompare(t.nodename)},U=function(e){return"PHYS_ERROR"===e||"ERROR"===e||"POWER_CYCLE"===e?b.red:"PHYS_HANG"===e?b.purple:"POWER_OFF"===e?b.grey:"PHYS_UNKNOWN"===e||"UNKNOWN"===e?b.yellow:"INIT"===e?b.blue:"SYNC"===e||"POWER_ON"===e?b.green:b.yellow},H=function(e,t,o){var n=new Map;return n.set("TOP",U(t.physState)),n.set("RIGHT",U(t.runState)),n.set("BOTTOM",U(t.runState)),n.set("LEFT",U(t.physState)),n.set("BORDER",U(t.physState)),void 0!==o&&Object.entries(o).forEach((function(o){var a=Object(s.a)(o,2),r=a[0],c=a[1],l=r,i=c;"PhysState"===i.category?i.valuesToColor.forEach((function(o,a){if("CFG"===i.DSCorCFG){if(a===e.physState)n.set(l,o.color);else if(void 0===t.runState){var r=b.black;i.valuesToColor.forEach((function(e){0===e.enum&&(r=e.color)})),n.set(l,r)}}else if(a===t.physState)n.set(l,o.color);else if(void 0===t.runState){var c=b.black;i.valuesToColor.forEach((function(e){0===e.enum&&(c=e.color)})),n.set(l,c)}})):"RunState"===i.category?i.valuesToColor.forEach((function(o,a){if("CFG"===i.DSCorCFG){if(a===e.runState)n.set(l,o.color);else if(void 0===t.runState){var r=b.black;i.valuesToColor.forEach((function(e){0===e.enum&&(r=e.color)})),n.set(l,r)}}else if(a===t.runState)n.set(l,o.color);else if(void 0===t.runState){var c=b.black;i.valuesToColor.forEach((function(e){0===e.enum&&(c=e.color)})),n.set(l,c)}})):"CFG"===i.DSCorCFG?void 0!==e.extensions&&e.extensions.forEach((function(e){var t=J($(i.category));if($(e["@type"])===t[0]){var o=B(e,0,t);if(void 0!==o)i.valuesToColor.forEach((function(e,t){t===o&&n.set(l,e.color)}));else{var a=b.black;i.valuesToColor.forEach((function(e){0===e.enum&&(a=e.color)})),n.set(l,a)}}})):void 0!==t.extensions&&t.extensions.forEach((function(e){var t=J($(i.category));if($(e["@type"])===t[0]){var o=B(e,0,t);if(void 0!==o)i.valuesToColor.forEach((function(e,t){t===o&&n.set(l,e.color)}));else{var a=b.black;i.valuesToColor.forEach((function(e){0===e.enum&&(a=e.color)})),n.set(l,a)}}}))})),n},L=function(e,t){if(void 0!==e.id){if(q(t.nodeid)===e.id)return V(t.url,e,t.value);console.error("node id does not match",t.nodeid.toUpperCase(),e.id.toUpperCase())}else console.error("node id is undefined")},B=function e(t,o,n){if(o!==n.length){var a=t[n[o].toLowerCase()];return void 0===a?e(t,o+1,n):a}},V=function(e,t,o){var n=!1,a=J(e);if(a[0].includes("type.googleapis.com")){var r=a[0]+"/"+a[1];a=a.slice(2,a.length),void 0!==t.extensions&&t.extensions.forEach((function(e){if(e["@type"]===r){var c=function(e,t,o,n){if(t!==o.length){if(t===o.length-1)return e[o[t].toLowerCase()]=n,e;var a=e[o[t].toLowerCase()];return void 0===a?a:B(a,t+1,o)}}(e,0,a,o);if(void 0!==c)return e=c,n=!0,t}}))}return n?t:void 0},_=function(e){for(var t=atob(e),o="",n=0;n<t.length;n++){var a=t.charCodeAt(n).toString(16);o+=2===a.length?a:"0"+a}return o.toUpperCase()},K=function(e){var t="";try{t=atob(e)}catch(r){return e}for(var o="",n=0;n<t.length;n++){var a=t.charCodeAt(n).toString(10);o+=0===n?a:"."+a}return o},Y=function(e){if(void 0!==e){var t=_(e);return t=t.replace(/(.{8})(.{4})(.{4})(.{4})(.{10})/,"$1-$2-$3-$4-$5")}return""},q=function(e){return function(e){var t=e.match(/.{1,2}/g),o="";if(null!==t)for(var n=0;n<t.length;n++)o+=String.fromCharCode(parseInt(t[n],16));return btoa(o)}(e.replace(/-/g,""))},z=function(e,t){switch(!0){case e.includes("ip"):return K(t);case e.includes("mac"):return function(e){var t=_(e);return t=t.replace(/(.{2})(.{2})(.{2})(.{2})(.{2})(.{2})/,"$1:$2:$3:$4:$5:$6")}(t);case e.includes("subnet"):return K(t);default:return t}},$=function(e){return e.replace("type.googleapis.com/","").replace("proto.","")},J=function(e){var t=e.split(/[/,_]+/);return t.length>1&&""===t[0]&&t.shift(),t},X=function(e,t,o){return fetch(e,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)}).then((function(e){return e.json()})).then(o).catch((function(e){return console.error("putNode error:",e)}))},Q=function(e,t){var o=Object(R.cloneDeep)(e),n=new Map,a=new Map;if(void 0!==t){if(void 0!==o.extensions){for(var r=0;r<o.extensions.length;r++)n.set(o.extensions[r]["@type"],o.extensions[r]);if(void 0!==t.extensions)for(var c=0;c<t.extensions.length;c++){var s=n.get(t.extensions[c]["@type"]);if(void 0!==s){var l=Object(I.a)({},s,{},t.extensions[c]);n.set(s["@type"],l)}else n.set(t.extensions[c]["@type"],t.extensions[c])}}if(void 0!==o.services){for(var i=0;i<o.services.length;i++)a.set(o.services[i].id,o.services[i]);if(void 0!==t.services)for(var d=0;d<t.services.length;d++){var u=a.get(t.services[d].id);if(void 0!==u){var p=Object(I.a)({},u,{},t.services[d]);a.set(u.id,p)}else a.set(t.services[d].id,t.services[d])}}}return o.physState=t.physState,o.runState=t.runState,o.extensions=Array.from(n.values()),o.services=Array.from(a.values()),o},Z=function(e){function t(e){var o;return Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).leftText=void 0,o.rightText=void 0,o.sortCategories=function(e){var t=[];return e.forEach((function(e,o){var n=Object(R.cloneDeep)(e);n.category=o,t.push(n)})),t=t.sort((function(e,t){return e.category.localeCompare(t.category)}))},o.componentDidMount=function(){o.leftText.current.offsetWidth>o.rightText.current.offsetWidth?o.setState({rightWidth:o.leftText.current.offsetWidth+7}):o.leftText.current.offsetWidth<o.rightText.current.offsetWidth&&o.setState({leftWidth:o.rightText.current.offsetWidth+7})},o.render=function(){var e=new Map,t=Object(R.cloneDeep)(o.props.colorInfo);Object.entries(t).forEach((function(o){var n=Object(s.a)(o,2),a=n[0],r=n[1];e.set(r.category,r),Object.entries(t).forEach((function(t){var o=Object(s.a)(t,2),n=o[0],c=o[1];a!==n&&c.category===r.category&&c.DSCorCFG!==r.DSCorCFG&&(e.set("".concat(r.category,"(").concat(r.DSCorCFG,")"),r),e.delete(r.category))}))})),Object.entries(o.props.colorInfo).forEach((function(o){var n=Object(s.a)(o,2),a=n[0],r=n[1],c=a;void 0===e.get(r.category)&&e.forEach((function(e,o){r.category===e.category&&r.DSCorCFG===e.DSCorCFG&&(t[c].category=o)}))}));var n=o.sortCategories(e);return a.a.createElement("div",{className:"legend"},a.a.createElement("div",{className:"legend-title"},"Legend"),a.a.createElement("div",{className:"row",id:"first-row"},a.a.createElement("div",{id:"top-text"},$(t.TOP.category).charAt(0).toUpperCase()+$(t.TOP.category).slice(1)),a.a.createElement("div",{id:"middle-row"},a.a.createElement("div",{id:"left-text",ref:o.leftText,style:null!==o.state.leftWidth?{width:"".concat(o.state.leftWidth,"px")}:{}},$(t.LEFT.category).charAt(0).toUpperCase()+$(t.LEFT.category).slice(1)),a.a.createElement("div",{className:"square-border",style:{backgroundColor:Array.from(t.BORDER.valuesToColor.values())[0].color}},a.a.createElement("div",{className:"square",style:{borderTopColor:Array.from(t.TOP.valuesToColor.values())[0].color,borderRightColor:Array.from(t.RIGHT.valuesToColor.values())[0].color,borderBottomColor:Array.from(t.BOTTOM.valuesToColor.values())[0].color,borderLeftColor:Array.from(t.LEFT.valuesToColor.values())[0].color,width:"0%"}})),a.a.createElement("div",{id:"right-text",ref:o.rightText,style:null!==o.state.rightWidth?{width:"".concat(o.state.rightWidth,"px")}:{}},$(t.RIGHT.category).charAt(0).toUpperCase()+$(t.RIGHT.category).slice(1))),a.a.createElement("div",{id:"bottom-text"},$(t.BOTTOM.category).charAt(0).toUpperCase()+$(t.BOTTOM.category).slice(1)),a.a.createElement("div",{id:"border-text"},$(t.BORDER.category).charAt(0).toUpperCase()+$(t.BORDER.category).slice(1))),n.map((function(e){return a.a.createElement(ee,{nodeColorInfoArea:e,key:e.category})})))},o.leftText=a.a.createRef(),o.rightText=a.a.createRef(),o.state={leftWidth:void 0,rightWidth:void 0},o}return Object(p.a)(t,e),t}(n.Component),ee=function(e){return a.a.createElement("div",null,a.a.createElement("div",{className:"legend-category-title"},"".concat($(e.nodeColorInfoArea.category).charAt(0).toUpperCase()+$(e.nodeColorInfoArea.category).slice(1),":")),Array.from(e.nodeColorInfoArea.valuesToColor.entries()).map((function(e){var t=Object(s.a)(e,2),o=t[0],n=t[1];return a.a.createElement("div",{className:"legend-color-value-row",key:n.enum},a.a.createElement("div",{className:"legend-color",style:{backgroundColor:n.color}}),a.a.createElement("div",{className:"legend-value"},o))})))},te=function(e){var t=U(e.dsc.physState),o=Y(e.dsc.id);return a.a.createElement(y.b,{className:"master-square-border",style:{backgroundColor:oe(t,-30)},to:"node/".concat(o)},a.a.createElement("div",{className:"master-square",style:{backgroundColor:t}},"Master"))},oe=function(e,t){var o=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16),a=parseInt(e.substring(6,8),16);return o=Math.round(o*(100+t)/100),n=(n=Math.round(n*(100+t)/100))<255?n:255,a=(a=Math.round(a*(100+t)/100))<255?a:255,"#"+(1===(o=o<255?o:255).toString(16).length?"0"+o.toString(16):o.toString(16))+(1===n.toString(16).length?"0"+n.toString(16):n.toString(16))+(1===a.toString(16).length?"0"+a.toString(16):a.toString(16))},ne=function(e){void 0===e.dsc.physState&&(e.dsc.physState="PHYS_UNKNOWN"),void 0===e.dsc.runState&&(e.dsc.runState="UNKNOWN");var t=e.cfg.nodename,o=Y(e.cfg.id),n=H(e.cfg,e.dsc,e.colorInfo),r="Name: ".concat(t,"\nUUID: ").concat(o,"\nPhysical State: ").concat(e.dsc.physState,"\nRun State: ").concat(e.dsc.runState);return a.a.createElement(y.b,{"data-popup":r,className:"square-border",to:"node/".concat(o),style:{backgroundColor:n.get("BORDER")}},a.a.createElement("div",{className:"square",style:{borderTopColor:n.get("TOP"),borderRightColor:n.get("RIGHT"),borderBottomColor:n.get("BOTTOM"),borderLeftColor:n.get("LEFT")}}))},ae=function(e){function t(){var e,o;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(o=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).stateCount=function(e){var t=0,o=0,n=0;return e.forEach((function(e){switch(e.runState){case"UNKNOWN":t++;break;case"INIT":o++;break;case"SYNC":n++;break;default:t++}})),{unknownCount:t,initCount:o,syncCount:n}},o.componentDidMount=function(){o.props.opened()},o.render=function(){var e=o.stateCount(o.props.dscNodes);return a.a.createElement(a.a.Fragment,null,o.props.disconnected&&a.a.createElement("h2",{style:{textAlign:"center",fontFamily:"Arial",color:"maroon"}},"Disconnected From Kraken"),0===o.props.dscNodes.size&&void 0===o.props.cfgMasterNode.id?a.a.createElement("h3",{style:{fontFamily:"Arial"}},"Loading..."):a.a.createElement("div",{className:"cluster"},a.a.createElement(te,{dsc:o.props.dscMasterNode,cfg:o.props.cfgMasterNode}),a.a.createElement("div",{className:"cluster-nodelist"},Array.from(o.props.dscNodes.values()).map((function(e){if(void 0!==e.id){var t=o.props.cfgNodes.get(e.id);if(void 0!==t)return a.a.createElement(ne,{cfg:t,dsc:e,key:e.id,colorInfo:o.props.colorInfo})}return a.a.createElement("div",null)})))),a.a.createElement("div",{className:"counts-area"},a.a.createElement("div",{className:"counts"},"Unknown: ",e.unknownCount),a.a.createElement("div",{className:"counts"},"Init: ",e.initCount),a.a.createElement("div",{className:"counts"},"Sync: ",e.syncCount)))},o}return Object(p.a)(t,e),t}(n.Component);function re(e){return a.a.createElement("div",{className:"dashboard"},a.a.createElement(Z,{colorInfo:e.colorInfo}),a.a.createElement("div",{className:"node-area"},a.a.createElement(ae,{opened:e.opened,disconnected:e.disconnected,cfgMasterNode:e.cfgMasterNode,dscMasterNode:e.dscMasterNode,cfgNodes:e.cfgNodes,dscNodes:e.dscNodes,colorInfo:e.colorInfo})),a.a.createElement("div",{className:"buffer-area"}))}var ce=function(e){void 0===e.dscNode.physState&&(e.dscNode.physState="PHYS_UNKNOWN"),void 0===e.dscNode.runState&&(e.dscNode.runState="UNKNOWN");var t=H(e.cfgNode,e.dscNode,e.colorInfo);return a.a.createElement("div",{className:"large-square-border",style:{backgroundColor:t.get("BORDER")}},a.a.createElement("div",{className:"large-square",style:{borderTopColor:t.get("TOP"),borderRightColor:t.get("RIGHT"),borderBottomColor:t.get("BOTTOM"),borderLeftColor:t.get("LEFT")}}))},se=o(23),le=(o(127),function(e){var t=void 0!==e.dscNode.runState?e.dscNode.runState:"",o=void 0!==e.cfgNode.runState?e.cfgNode.runState:"",n=void 0!==e.dscNode.physState?e.dscNode.physState:"",r=void 0!==e.cfgNode.physState?e.cfgNode.physState:"",c=Y(e.cfgNode.id),s="";null!==e.cfgNode.parentId&&void 0!==e.cfgNode.parentId?s=Y(e.cfgNode.parentId):e.cfgNode.nodename="Master";var l=void 0!==e.cfgNode.arch?e.cfgNode.arch:"",i=void 0!==e.cfgNode.platform?e.cfgNode.platform:"",d=pe("Node ID",0,c),u=""!==s?pe("Parent ID",0,s):a.a.createElement(a.a.Fragment,null),p=fe("Physical State",r,n),f=fe("Run State",o,t),g=""!==l?pe("Architecture",0,l):a.a.createElement(a.a.Fragment,null),h=""!==i?pe("Platform",0,i):a.a.createElement(a.a.Fragment,null),v=Q(e.cfgNode,e.dscNode),m=ie(v.extensions,"@type"),C=ie(v.services,"id"),N=ie(e.cfgNode.extensions,"@type"),E=ie(e.cfgNode.services,"id"),b=ie(e.dscNode.extensions,"@type"),S=ie(e.dscNode.services,"id");return a.a.createElement("div",{className:"node-detail"},a.a.createElement("h1",{className:"node-title"},e.cfgNode.nodename),a.a.createElement("div",{className:"non-bordered-detail"},d,u,p,f,g,h),a.a.createElement(se.d,null,a.a.createElement(se.b,null,a.a.createElement(se.a,null,"Mixed"),a.a.createElement(se.a,null,"CFG"),a.a.createElement(se.a,null,"DSC")),a.a.createElement(se.c,null,m.length>0?a.a.createElement("h2",null,"Extensions:"):a.a.createElement(a.a.Fragment,null),m,C.length>0?a.a.createElement("h2",null,"Services:"):a.a.createElement(a.a.Fragment,null),C),a.a.createElement(se.c,null,N.length>0?a.a.createElement("h2",null,"Extensions:"):a.a.createElement(a.a.Fragment,null),N,E.length>0?a.a.createElement("h2",null,"Services:"):a.a.createElement(a.a.Fragment,null),E),a.a.createElement(se.c,null,b.length>0?a.a.createElement("h2",null,"Extensions:"):a.a.createElement(a.a.Fragment,null),b,S.length>0?a.a.createElement("h2",null,"Services:"):a.a.createElement(a.a.Fragment,null),S)))}),ie=function(e,t){var o=[];if(void 0!==e){e.sort((function(e,o){return $(e[t])<$(o[t])?-1:$(e[t])>$(o[t])?1:0}));for(var n=0;n<e.length;n++)o.push(a.a.createElement(de,{extSrv:e[n],key:n,id:t}))}return o},de=function(e){for(var t=$(e.extSrv[e.id]),o=[],n=0,r=Object.keys(e.extSrv);n<r.length;n++){var c=r[n];c!==e.id&&o.push(ue(e.extSrv[c],c,0))}return 0===o.length?a.a.createElement("div",null,a.a.createElement("div",{className:"info-title-single"},t)):a.a.createElement("div",{className:"bordered-detail"},a.a.createElement("div",{className:"info-title"},t),o)},ue=function e(t,o,n){n++;var a=[];if(Array.isArray(t)){a.push(pe(o,n));for(var r=0;r<t.length;r++)a.push(e(t[r],r,n))}else if("object"===typeof t){a.push(pe(o,n));for(var c=0,s=Object.keys(t);c<s.length;c++){var l=s[c];a.push(e(t[l],l,n))}}else t===Boolean?a.push(pe(o,n,t.toString())):a.push(pe(o,n,z(o.toString(),t.toString())));return a},pe=function(e,t,o){var n=(15*(t-1)).toString()+"px";return a.a.createElement("div",{style:{paddingLeft:n},className:"node-view-row",key:e},a.a.createElement("span",{className:"node-view-key"},e,":"),a.a.createElement("span",{className:"node-view-value"},o))},fe=function(e,t,o){return a.a.createElement("div",{className:"cfg-dsc-row",key:e},a.a.createElement("div",{className:"cfg-dsc-title"},e,":"),a.a.createElement("div",{className:"cfg-dsc-value-row"},a.a.createElement("div",{className:"cfg-dsc-value-container"},a.a.createElement("div",{className:"cfg-dsc-key"},"CFG:"),a.a.createElement("div",{className:"cfg-dsc-value"},t)),a.a.createElement("div",{className:"cfg-dsc-value-container"},a.a.createElement("div",{className:"cfg-dsc-key"},"DSC:"),a.a.createElement("div",{className:"cfg-dsc-value"},o))))},ge=function(e){return a.a.createElement("div",{className:"actions-area",style:{display:void 0===e.cfgNode.parentId?"none":""}},a.a.createElement("div",{className:"button green",onClick:function(){var t,o;t=e.cfgNode,o=e.cfgUrlSingle,t.runState="SYNC",t.physState="POWER_ON",X(o,t)}},"Power On"),a.a.createElement("div",{className:"button red",onClick:function(){!function(e,t,o,n){if(e.physState="POWER_OFF",e.runState="UNKNOWN",void 0!==e.extensions)for(var a=0;a<e.extensions.length;a++)"type.googleapis.com/proto.PXE"===e.extensions[a]["@type"]?e.extensions[a].state="NONE":"type.googleapis.com/proto.RPi3"===e.extensions[a]["@type"]&&(e.extensions[a].pxe="NONE");if(t.runState="UNKNOWN",void 0!==t.extensions)for(var r=0;r<t.extensions.length;r++)"type.googleapis.com/proto.PXE"===t.extensions[r]["@type"]?t.extensions[r].state="NONE":"type.googleapis.com/proto.RPi3"===t.extensions[r]["@type"]&&(t.extensions[r].pxe="NONE");X(n,t,(function(){X(o,e)}))}(e.cfgNode,e.dscNode,e.cfgUrlSingle,e.dscUrlSingle)}},"Power Off"),a.a.createElement("div",{className:"button purple",id:"graph-button",onClick:e.graphToggle},a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100",height:"38",viewBox:"0 0 24 20"},a.a.createElement("path",{fill:"None",d:"M0 0h24v24H0V0z"}),a.a.createElement("path",{fill:"white",d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"}))))},he=o(48),ve=function(e){function t(e){var o;Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).appRef=void 0,o.configRef=void 0,o.toggleSettings=function(){o.setState({settingsMenu:!o.state.settingsMenu})},o.appRef=Object(n.createRef)(),o.configRef=Object(n.createRef)();for(var a=e.graph.nodes,r=0;r<a.length;r++){var c={border:a[r].color.border,background:a[r].color.background};a[r].color.highlight=c,a[r].borderWidth=2}var s={nodes:new he.a.DataSet(a),edges:new he.a.DataSet(e.graph.edges)};return o.state={data:s,settingsMenu:!1},o}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){if(void 0!==this.appRef&&void 0!==this.configRef){var e={edges:{arrows:{to:{enabled:!0,scaleFactor:1.5}},color:{inherit:!1},width:4},physics:{enabled:!0,barnesHut:{gravitationalConstant:-5e4}},height:"100%",width:"100%",configure:{filter:function(e,t){return-1!==t.indexOf("physics")||(-1!==t.indexOf("smooth")||"smooth"===e)},container:this.configRef.current}};new he.a.Network(this.appRef.current,this.state.data,e).fit(e)}else console.log("graph: ",this.appRef,"config: ",this.configRef)}},{key:"componentDidUpdate",value:function(e){if(this.props.graph!==e.graph){for(var t=this.state.data,o=this.props.graph.nodes,n=0;n<o.length;n++){var a={border:o[n].color.border,background:o[n].color.background};o[n].color.highlight=a,o[n].borderWidth=2}t.nodes.update(o),t.edges.update(this.props.graph.edges),this.forceUpdate()}}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"graph-area"},a.a.createElement("div",{className:"close-button",onClick:function(){e.props.graphToggle()}},a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 24 24"},a.a.createElement("path",{fill:"None",d:"M0 0h24v24H0V0z"}),a.a.createElement("path",{fill:b.grey,d:"M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"}))),a.a.createElement("button",{style:{position:"absolute",top:5,zIndex:10,left:25},onClick:this.toggleSettings},"settings"),a.a.createElement("div",{className:"node-graph",ref:this.appRef}),a.a.createElement("div",{style:this.state.settingsMenu?{display:"block"}:{display:"none"},className:"graph-settings",ref:this.configRef}))}}]),t}(n.Component),me=function(e){function t(e){var o;return Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){o.props.opened()},o.graphToggle=function(){o.setState({graphOpen:!o.state.graphOpen})},o.state={graphOpen:!1},o}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,this.props.disconnected&&a.a.createElement("h2",{style:{textAlign:"center",fontFamily:"Arial",color:"maroon"}},"Disconnected From Kraken"),void 0===this.props.cfgNode||void 0===this.props.dscNode?a.a.createElement("h3",{style:{fontFamily:"Arial"}},"Node Does Not Exist"):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"node-view"},a.a.createElement(ce,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode,colorInfo:this.props.colorInfo}),a.a.createElement(le,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode}),a.a.createElement(ge,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode,dscUrlSingle:this.props.dscUrlSingle,cfgUrlSingle:this.props.cfgUrlSingle,graphToggle:this.graphToggle})),void 0!==this.props.graph&&0!==Object.keys(this.props.graph).length&&this.state.graphOpen&&a.a.createElement(ve,{graph:this.props.graph,graphToggle:this.graphToggle})))}}]),t}(n.Component),Ce=o(110),Ne=function(e){return'{"TOP":'.concat(Ee(e.TOP),',"RIGHT":').concat(Ee(e.RIGHT),',"LEFT":').concat(Ee(e.LEFT),',"BOTTOM":').concat(Ee(e.BOTTOM),',"BORDER":').concat(Ee(e.BORDER),"}")},Ee=function(e){var t={};return e.valuesToColor.forEach((function(e,o){t[o]=e})),'{"category":"'.concat(e.category,'","DSCorCFG":"').concat(e.DSCorCFG,'","valuesToColor":').concat(JSON.stringify(t),"}")},be=function(e){var t=new Map;return Object.entries(e).forEach((function(e){var o=Object(s.a)(e,2),n=o[0],a=o[1];t.set(n,{enum:a.enum,color:a.color})})),t},Se=function(e){function t(e){var o;return Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).changeSelectedArea=function(e){o.setState({selected:e})},o.state={selected:"TOP"},o}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"node-color-area"},a.a.createElement(ye,{selected:this.state.selected,colorInfo:this.props.currentColorConfig,changeSelectedArea:this.changeSelectedArea}),a.a.createElement(Oe,{selectedArea:this.state.selected,stateOptions:this.props.nodeStateOptions,currentColorConfig:this.props.currentColorConfig,changeColorInfo:this.props.changeColorInfo}))}}]),t}(n.Component),ye=function(e){var t=Array.from(e.colorInfo.BORDER.valuesToColor.values())[0].color,o=Array.from(e.colorInfo.TOP.valuesToColor.values())[0].color,n=Array.from(e.colorInfo.RIGHT.valuesToColor.values())[0].color,r=Array.from(e.colorInfo.BOTTOM.valuesToColor.values())[0].color,c=Array.from(e.colorInfo.LEFT.valuesToColor.values())[0].color;return a.a.createElement("div",{className:"area-selector-area"},a.a.createElement("div",{className:"color-square"},a.a.createElement("div",{style:"BORDER"===e.selected?{borderColor:b.red}:{borderColor:"transparent"},className:"color-square-border-border"}),a.a.createElement("div",{style:{borderColor:t},className:"color-square-border",onClick:function(){e.changeSelectedArea("BORDER")}}),a.a.createElement("div",{className:"color-square-mask"},a.a.createElement("div",{style:{backgroundColor:o},className:"color-square-top",onClick:function(){e.changeSelectedArea("TOP")}}),a.a.createElement("div",{style:{backgroundColor:n},className:"color-square-right",onClick:function(){e.changeSelectedArea("RIGHT")}}),a.a.createElement("div",{style:{backgroundColor:r},className:"color-square-bottom",onClick:function(){e.changeSelectedArea("BOTTOM")}}),a.a.createElement("div",{style:{backgroundColor:c},className:"color-square-left",onClick:function(){e.changeSelectedArea("LEFT")}})),a.a.createElement("div",{style:"TOP"===e.selected?{borderTopColor:b.red}:{borderTopColor:"transparent"},className:"color-square-top-border"}),a.a.createElement("div",{style:"RIGHT"===e.selected?{borderRightColor:b.red}:{borderRightColor:"transparent"},className:"color-square-right-border"}),a.a.createElement("div",{style:"BOTTOM"===e.selected?{borderBottomColor:b.red}:{borderBottomColor:"transparent"},className:"color-square-bottom-border"}),a.a.createElement("div",{style:"LEFT"===e.selected?{borderLeftColor:b.red}:{borderLeftColor:"transparent"},className:"color-square-left-border"})))},Oe=function(e){function t(e){var o;Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).getState=function(){var e=[],t=new Map,n=[],a=new Map,r=o.props.currentColorConfig[o.props.selectedArea];return void 0!==o.props.stateOptions&&(e=o.props.stateOptions),e.forEach((function(e){n.push(e.name),e.name===r.category&&(t=e.options)})),t.forEach((function(e){o.props.currentColorConfig[o.props.selectedArea].valuesToColor.forEach((function(t,o){o===e&&a.set(e,{enum:t.enum,color:t.color})}))})),{selectedAreaInfo:r,availableCategoryNames:n,availableValues:t,currentColorsForAvailableValues:a}},o.componentDidUpdate=function(e){if(e!==o.props){var t=o.getState(),n=Array.from(t.availableValues.values())[0];void 0!==o.state.selectedValueName&&void 0!==t.currentColorsForAvailableValues.get(o.state.selectedValueName)&&(n=o.state.selectedValueName),o.setState({selectedValueName:n,selectedAreaInfo:t.selectedAreaInfo,availableCategoryNames:t.availableCategoryNames,availableValues:t.availableValues,currentColorsForAvailableValues:t.currentColorsForAvailableValues})}},o.changeSelectedValue=function(e){o.setState({selectedValueName:e})},o.handleCategoryChange=function(e){var t=Object(R.cloneDeep)(o.props.currentColorConfig),n=new Map,a=new Map,r=!1;Object.values(o.props.currentColorConfig).forEach((function(n){n.category===e&&"DSC"===n.DSCorCFG&&(r=!0,t[o.props.selectedArea].category=e,t[o.props.selectedArea].DSCorCFG="DSC",t[o.props.selectedArea].valuesToColor=n.valuesToColor)})),r||(void 0!==o.props.stateOptions&&o.props.stateOptions.forEach((function(t){t.name===e&&(a=t.options)})),a.forEach((function(e,t){n.set(e,{enum:t,color:b.grey})})),t[o.props.selectedArea].DSCorCFG="DSC",t[o.props.selectedArea].category=e,t[o.props.selectedArea].valuesToColor=n),o.props.changeColorInfo(t)},o.handleDSCCFGChange=function(e){var t=Object(R.cloneDeep)(o.props.currentColorConfig);t[o.props.selectedArea].DSCorCFG=e,Object.entries(o.props.currentColorConfig).forEach((function(n){var a=Object(s.a)(n,2),r=a[0],c=a[1];r!==o.props.selectedArea&&c.category===t[o.props.selectedArea].category&&c.DSCorCFG===e&&(t[o.props.selectedArea].valuesToColor=c.valuesToColor)})),o.props.changeColorInfo(t)},o.handleColorChange=function(e){var t=Object(R.cloneDeep)(o.props.currentColorConfig),n=new Map;t[o.props.selectedArea].valuesToColor.forEach((function(t,a){a===o.state.selectedValueName?n.set(a,{enum:t.enum,color:e.hex}):n.set(a,t)})),t[o.props.selectedArea].valuesToColor=n,Object.entries(o.props.currentColorConfig).forEach((function(e){var a=Object(s.a)(e,2),r=a[0],c=a[1],l=r;l!==o.props.selectedArea&&c.category===t[o.props.selectedArea].category&&c.DSCorCFG===t[o.props.selectedArea].DSCorCFG&&(t[l].valuesToColor=n)})),o.props.changeColorInfo(t)};var n=o.getState();return o.state={selectedValueName:Array.from(n.availableValues.values())[0],selectedAreaInfo:n.selectedAreaInfo,availableCategoryNames:n.availableCategoryNames,availableValues:n.availableValues,currentColorsForAvailableValues:n.currentColorsForAvailableValues},o}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(void 0===this.props.stateOptions)return a.a.createElement("div",null,"Could Not Get Node State Options From Kraken");var t=b.black,o=this.state.currentColorsForAvailableValues.get(this.state.selectedValueName);return void 0!==o&&(t=o.color),a.a.createElement("div",{className:"color-details-area"},a.a.createElement("h1",null,this.props.selectedArea),a.a.createElement("div",{className:"color-selection-area"},a.a.createElement("div",null,a.a.createElement("div",{className:"color-details-row"},a.a.createElement("div",{style:{display:"inline-block",margin:"auto 10px"}},"Category:"),a.a.createElement(ke,{options:this.state.availableCategoryNames,value:this.state.selectedAreaInfo.category,onChange:this.handleCategoryChange})),a.a.createElement("div",{className:"color-details-row"},a.a.createElement("div",{style:{display:"inline-block",margin:"auto 10px"}},"DSC or CFG:"),a.a.createElement(ke,{options:["DSC","CFG"],value:this.state.selectedAreaInfo.DSCorCFG,onChange:this.handleDSCCFGChange}))),a.a.createElement("div",null,Array.from(this.state.availableValues.entries()).sort(Te).map((function(t){return a.a.createElement("div",{className:"color-details-row",key:t[0],style:e.state.selectedValueName===t[1]?{borderColor:b.borderGrey,cursor:"pointer",backgroundColor:"#f0f0f0"}:{cursor:"pointer"},onClick:function(){e.changeSelectedValue(t[1])}},a.a.createElement("div",{className:"color-details-row-key",style:{display:"inline-block",margin:"auto 10px"}},"".concat(t[1],":")),a.a.createElement("div",{className:"color-details-current-square",style:{backgroundColor:we(e.state.currentColorsForAvailableValues,t[1])}}))}))),a.a.createElement(Ce.SketchPicker,{presetColors:Object.values(b),disableAlpha:!0,color:t,onChange:this.handleColorChange})))}}]),t}(n.Component),ke=function(e){return a.a.createElement("select",{className:"dropdown",value:e.value.replace("proto.",""),onChange:function(t){e.onChange(t.target.value)}},e.options.map((function(e){return a.a.createElement("option",{key:e},e.replace("proto.",""))})))},Te=function(e,t){var o=Object(s.a)(e,2),n=o[0],a=(o[1],Object(s.a)(t,2)),r=a[0];a[1];return n<r?-1:n>r?1:0},we=function(e,t){var o=e.get(t);return void 0!==o?o.color:b.black},Re=function(e){var t,o;return x.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x.a.awrap(F(e).catch((function(e){return null})));case 2:if(null!==(t=n.sent)){n.next=5;break}return n.abrupt("return",null);case 5:return o=[],t.forEach((function(e){var t={name:e.name,url:e.url,options:new Map},n=new Map;if("PhysState"===e.name)Object.entries(e.options).forEach((function(e){var t=Object(s.a)(e,2),o=t[0],a=t[1];"POWER_ON"===a&&n.set(parseInt(o),a)})),Object.entries(e.options).forEach((function(e){var t=Object(s.a)(e,2),o=t[0],a=t[1];n.set(parseInt(o),a)}));else if("RunState"===e.name)Object.entries(e.options).forEach((function(e){var t=Object(s.a)(e,2),o=t[0],a=t[1];"SYNC"===a&&n.set(parseInt(o),a)})),Object.entries(e.options).forEach((function(e){var t=Object(s.a)(e,2),o=t[0],a=t[1];n.set(parseInt(o),a)}));else{var a=J(t.url);t.name=$(a[a.length-2])+"/"+e.name,Object.entries(e.options).forEach((function(e){var t=Object(s.a)(e,2),o=t[0],a=t[1];n.set(parseInt(o),a)}))}t.options=n,o.push(t)})),n.abrupt("return",o);case 8:case"end":return n.stop()}}))},Ie=function(e){function t(e){var o;Object(l.a)(this,t),(o=Object(d.a)(this,Object(u.a)(t).call(this,e))).pollingTimeout=void 0,o.reconnectTimeout=void 0,o.websocket=void 0,o.getUrl=function(e){return"http://"+o.state.krakenIP+e},o.componentDidMount=function(){o.refetch()},o.componentDidUpdate=function(e,t){if(o.state.useWebSocket!==t.useWebSocket&&"RECONNECT"!==o.state.liveConnectionActive&&o.setState({liveConnectionActive:o.state.useWebSocket?"WEBSOCKET":"POLLING"}),o.state.updatingGraph!==t.updatingGraph&&void 0!==o.state.updatingGraph&&o.getGraph(o.state.updatingGraph),o.state.refreshRate!==t.refreshRate)switch(o.state.liveConnectionActive){case"POLLING":o.stopPolling(),o.startPolling();break;case"RECONNECT":o.stopReconnect(),o.startReconnect()}if(o.state.krakenIP!==t.krakenIP)return localStorage.setItem("kraken-ip",o.state.krakenIP),void o.setState({refreshRate:g,useWebSocket:h,krakenIP:o.state.krakenIP,masterNode:{},nodes:new Map,cfgNodes:new Map,cfgMaster:{},dscNodes:new Map,dscMaster:{},liveConnectionActive:"REFETCH",updatingGraph:void 0,graph:void 0,colorInfo:S},o.refetch);if(t.liveConnectionActive!==o.state.liveConnectionActive){switch(t.liveConnectionActive){case"POLLING":o.stopPolling();break;case"WEBSOCKET":"REFETCH"!==o.state.liveConnectionActive&&o.stopWebSocket();break;case"RECONNECT":o.stopReconnect()}switch(o.state.liveConnectionActive){case"POLLING":o.startPolling();break;case"WEBSOCKET":o.startWebSocket(o.refetch);break;case"RECONNECT":o.startReconnect();break;case"REFETCH":o.refetch()}}},o.handleRefreshChange=function(e){o.setState({refreshRate:e})},o.handleWebsocketChange=function(e){o.setState({useWebSocket:e})},o.handleIpChange=function(e){o.validateIPaddress(e)&&o.setState({krakenIP:e})},o.stopPolling=function(){void 0!==o.pollingTimeout&&clearInterval(o.pollingTimeout),o.pollingTimeout=void 0},o.startPolling=function(){var e=o.state.refreshRate;e<.15&&(e=.15),o.pollingTimeout=setInterval(o.pollingFunction,1e3*e)},o.pollingFunction=function(){void 0!==o.state.cfgMaster.id?W(o.getUrl(v),o.state.cfgMaster.id).then((function(e){if(null!==e.masterNode&&null!==e.computeNodes)if(null===o.validateNodes(o.state.cfgMaster,o.state.cfgNodes,e.masterNode,e.computeNodes)){var t=void 0,n=o.state.updatingGraph;void 0!==n&&(t=function(){o.getGraph(n)}),o.setFinalNodes(o.state.cfgMaster,o.state.cfgNodes,e.masterNode,e.computeNodes,t)}else o.setState({liveConnectionActive:"REFETCH"});else o.setState({liveConnectionActive:"RECONNECT"})})):o.setState({liveConnectionActive:"RECONNECT"})},o.stopWebSocket=function(){void 0!==o.websocket&&(o.websocket.onclose=function(){console.log("Closing WebSocket")},o.websocket.close(1e3)),o.websocket=void 0},o.startWebSocket=function(e){void 0===o.websocket?F(o.getUrl(C)).then((function(t){var n="ws://".concat(t.host,":").concat(t.port).concat(t.url);o.websocket=new WebSocket(n),o.websocket.onopen=function(){console.log("WebSocket Connected"),void 0!==o.websocket?(o.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:"STATE_CHANGE"})),o.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:"STATE_MUTATION"})),o.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:"DISCOVERY"})),e()):(console.warn("Websocket is somehow undefined"),o.setState({liveConnectionActive:"RECONNECT"}))},o.websocket.onmessage=function(e){var t=JSON.parse(e.data);null!==t&&o.handleWebSocketMessage(t)},o.websocket.onclose=function(e){console.warn("Websocket closed unexpectedly",e),o.setState({liveConnectionActive:"RECONNECT"})}})).catch((function(e){if("The operation is insecure."===e.message)return console.warn("Could not establish a websocket connection:",e),void o.setState({liveConnectionActive:"RECONNECT"});console.warn("Could not establish a websocket connection. Falling back to polling mode. Error:",e),o.setState({useWebSocket:!1})})):console.warn("Websocket already connected, refusing to create another")},o.handleWebSocketMessage=function(e){for(var t=Object(R.cloneDeep)(o.state.nodes),n=Object(R.cloneDeep)(o.state.dscNodes),a=!1,r=0;r<e.length;r++)if(1===e[r].type){if(e[r].data.includes("(CREATE)")||e[r].data.includes("(CFG_UPDATE")){console.log("Creation or update found. Close websocket and pull dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"});break}var c=e[r];if("/PhysState"===c.url||"/RunState"===c.url){var s=q(c.nodeid),l=t.get(s),i=n.get(s);if(void 0===l||void 0===i){console.log("couldn't find node. Closing websocket and pulling dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"});break}switch(c.url){case"/PhysState":l.physState=c.value,i.physState=c.value,"POWER_OFF"===c.value?(l.runState="UNKNOWN",i.runState="UNKNOWN"):"PHYS_HANG"===c.value&&(l.runState="UNKNOWN",i.runState="UNKNOWN");break;case"/RunState":if("UNKNOWN"===c.value||"PHYS_UNKNOWN"!==l.physState&&"POWER_OFF"!==l.physState&&"PHYS_HANG"!==l.physState){l.runState=c.value,i.runState=c.value;break}console.log("Tried to change node's runstate while phystate is unknown. Closing websocket and pulling dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"})}a=!0}else if(c.url.includes("type.googleapis.com")){var d=q(c.nodeid),u=t.get(d),p=n.get(d);if(void 0===u||void 0===p){console.log("couldn't find node. Closing websocket and pulling dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"});break}var f=L(u,c);void 0!==f&&(u=f,a=!0);var g=L(p,c);void 0!==g&&(p=g,a=!0)}}else void 0===o.state.updatingGraph||2!==e[r].type&&5!==e[r].type||e[r].nodeid!==Y(o.state.updatingGraph).toLowerCase()||o.getGraph(o.state.updatingGraph);a&&o.setState({nodes:t,dscNodes:n})},o.setFinalNodes=function(e,t,n,a,r){var c=Object(R.cloneDeep)(t),s=new Map;c.forEach((function(e,t,o){var n=a.get(t);if(void 0!==n){var r=Q(e,n);void 0!==r.id&&s.set(r.id,r)}}));var l=new Map,i=new Map,d=new Map,u=Array.from(s.values()).sort(D);s=new Map;for(var p=0;p<u.length;p++){var f=u[p].id;if(void 0!==f){s.set(f,u[p]);var g=a.get(f),h=t.get(f);void 0!==g&&i.set(f,g),void 0!==h&&d.set(f,h),l.set(f,p)}}var v=e;v.physState=n.physState,v.runState=n.runState,o.setState({masterNode:v,nodes:s,cfgMaster:e,cfgNodes:d,dscMaster:n,dscNodes:i},r)},o.validateNodes=function(e,t,o,n){return void 0===e.id?Error("Missing cfg master"):0===Object.entries(o).length?Error("Missing dsc master"):t.size!==n.size?Error("cfg and dsc node lists are different sizes"):(t.forEach((function(e){return void 0===e.id?Error("A compute node id was undefined"):void 0===n.get(e.id)?Error("Could not find a cfg node in dsc node list"):void 0})),null)},o.stopReconnect=function(){void 0!==o.reconnectTimeout&&clearInterval(o.reconnectTimeout),o.reconnectTimeout=void 0},o.startReconnect=function(){console.log("Starting Reconnect");var e=o.state.refreshRate;e<.15&&(e=.15),o.reconnectTimeout=setInterval(o.reconnectFunction,1e3*e)},o.reconnectFunction=function(){j(o.getUrl(m)).then((function(e){null!==e.masterNode&&null!==e.computeNodes&&void 0!==e.masterNode.id&&o.setState({liveConnectionActive:"REFETCH"})}))},o.refetch=function(){console.log("Refetching"),G(o.getUrl(m),o.getUrl(v)).then((function(e){null!==e.cfgMasterNode&&null!==e.cfgComputeNodes&&null!==e.dscMasterNode&&null!==e.dscComputeNodes?o.setFinalNodes(e.cfgMasterNode,e.cfgComputeNodes,e.dscMasterNode,e.dscComputeNodes,(function(){o.state.useWebSocket?o.setState({liveConnectionActive:"WEBSOCKET"}):o.setState({liveConnectionActive:"POLLING"})})):o.setState({liveConnectionActive:"RECONNECT"})})),Re(o.getUrl(N)).then((function(e){null!==e&&o.setState({nodeStateOptions:e},o.getStoredColorInfo)}))},o.getGraph=function(e){F(o.getUrl(E(Y(e)))).then((function(e){null===e?o.setState({liveConnectionActive:"RECONNECT"}):o.setState({graph:e})}))},o.startUpdatingGraph=function(e){o.setState({updatingGraph:e})},o.stopUpdatingGraph=function(){o.setState({updatingGraph:void 0,graph:void 0})},o.changeColorInfo=function(e){o.setState({colorInfo:e}),localStorage.setItem("colorInfo",Ne(e))},o.getStoredColorInfo=function(){var e=localStorage.getItem("colorInfo");if(null!==e){var t=JSON.parse(e);if(Object.entries(t).forEach((function(e){var t=Object(s.a)(e,2),o=(t[0],t[1]);o.valuesToColor=be(o.valuesToColor)})),void 0===o.state.nodeStateOptions)return;var n=[];o.state.nodeStateOptions.forEach((function(e){n.push(e.name)}));var a=!1;if(Object.entries(t).forEach((function(e){var t=Object(s.a)(e,2),o=(t[0],t[1]);n.includes(o.category)||(console.log("Stored color info contains a category that this kraken doesn't know about. Using defaults."),a=!0)})),a)return;o.setState({colorInfo:t})}},o.validateIPaddress=function(e){return!!/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]):[0-9]+$/.test(e)||(alert("You have entered an invalid IP address and port!"),!1)};var n=localStorage.getItem("kraken-ip");return null===n&&(n=f),o.state={refreshRate:g,useWebSocket:h,krakenIP:n,masterNode:{},nodes:new Map,cfgNodes:new Map,cfgMaster:{},dscNodes:new Map,dscMaster:{},liveConnectionActive:"REFETCH",updatingGraph:void 0,graph:void 0,colorInfo:S},o}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(y.a,null,a.a.createElement(k,{refreshRate:this.state.refreshRate,handleRefreshChange:this.handleRefreshChange,useWebSocket:this.state.useWebSocket,handleWebsocketChange:this.handleWebsocketChange,krakenIP:this.state.krakenIP,handleIpChange:this.handleIpChange}),a.a.createElement(a.a.Fragment,null,a.a.createElement(O.a,{onchange:function(){console.log("route got clicked!")},exact:!0,path:"/",render:function(){return a.a.createElement(re,{disconnected:"RECONNECT"===e.state.liveConnectionActive,cfgMasterNode:e.state.cfgMaster,dscMasterNode:e.state.dscMaster,cfgNodes:e.state.cfgNodes,dscNodes:e.state.dscNodes,opened:e.stopUpdatingGraph,colorInfo:e.state.colorInfo})}}),a.a.createElement(O.a,{path:"/node/:uuid",render:function(t){return a.a.createElement(me,{disconnected:"RECONNECT"===e.state.liveConnectionActive,cfgNode:e.state.cfgMaster.id===q(t.match.params.uuid)?e.state.cfgMaster:e.state.cfgNodes.get(q(t.match.params.uuid)),dscNode:e.state.dscMaster.id===q(t.match.params.uuid)?e.state.dscMaster:e.state.dscNodes.get(q(t.match.params.uuid)),cfgUrlSingle:e.getUrl("/cfg/node"),dscUrlSingle:e.getUrl("/dsc/node"),opened:function(){q(t.match.params.uuid)!==e.state.masterNode.id&&e.startUpdatingGraph(q(t.match.params.uuid))},graph:e.state.graph,colorInfo:e.state.colorInfo})}}),a.a.createElement(O.a,{exact:!0,path:"/settings",render:function(){return a.a.createElement(Se,{nodeStateOptions:e.state.nodeStateOptions,currentColorConfig:e.state.colorInfo,changeColorInfo:e.changeColorInfo})}})))}}]),t}(n.Component);c.a.render(a.a.createElement(Ie,null),document.getElementById("root"))},71:function(e,t,o){}},[[111,1,2]]]);
//# sourceMappingURL=main.050dec14.chunk.js.map