(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,a){e.exports=a(35)},21:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(13),o=a.n(s),c=(a(21),a(5)),l=a(6),i=a(8),d=a(7),u=a(9),m={yellow:"#f2cf66",red:"#e74c3c",grey:"#a5a5a5",purple:"#6a51ba",green:"#89CA78",blue:"#509EE8",black:"#000000"},h="192.168.57.10:3141";function f(e){return"PHYS_ERROR"===e|"ERROR"===e|"POWER_CYCLE"===e?m.red:"PHYS_HANG"===e?m.purple:"POWER_OFF"===e?m.grey:"PHYS_UNKNOWN"===e|"UNKNOWN"===e?m.yellow:"INIT"===e?m.blue:"SYNC"===e|"POWER_ON"===e?m.green:m.yellow}function p(e){for(var t=atob(e),a="",n=0;n<t.length;n++){var r=t.charCodeAt(n).toString(16);a+=2===r.length?r:"0"+r}return a.toUpperCase()}function N(e){for(var t=atob(e),a="",n=0;n<t.length;n++){var r=t.charCodeAt(n).toString(10);a+=0===n?r:"."+r}return a}function v(e){if("undefined"===typeof e)return"";var t=p(e);return t=t.replace(/(.{8})(.{4})(.{4})(.{4})(.{10})/,"$1-$2-$3-$4-$5")}function g(e){return fetch(e).then(function(e){return e.json()}).then(function(e){return e.nodes}).catch(function(e){return null})}function y(e){return fetch(e).then(function(e){return e.json()}).catch(function(e){return console.warn(e),null})}function E(e,t){return fetch(e,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){return console.log("Success:",JSON.stringify(e))}).catch(function(e){return console.error("Error:",e)})}var _=a(36);function b(){return r.a.createElement("h1",{className:"banner_title"},"Kraken")}var S=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(d.a)(t).call(this,e))).state={dsc_url:"http://".concat(h,"/dsc/nodes"),cfg_url:"http://".concat(h,"/cfg/nodes"),graph_url:"http://".concat(h,"/graph/json"),graph:{},refreshRate:400,masterNode:{},nodes:[],unknown_count:0,init_count:0,sync_count:0,dsc_loaded:!1},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.interval=window.setInterval(function(){e.nodeInfoUpdate(e.state.dsc_url),e.graphFetch(e.state.graph_url)},this.state.refreshRate),this.initialNodeFetch(this.state.cfg_url),this.graphFetch(this.state.graph_url),this.nodeInfoUpdate(this.state.dsc_url)}},{key:"graphFetch",value:function(e){var t=this;this.setState({loading:!0}),y(e).then(function(e){t.setState({graph:e})})}},{key:"initialNodeFetch",value:function(e){var t=this;this.setState({loading:!0}),g(e).then(function(e){if(null===e)t.setState({disconnected:!0});else{for(var a=0;a<e.length;a++)null!==e[a].parentId&&"undefined"!==typeof e[a].parentId||(t.setState({masterNode:e[a]}),e.splice(a,1));e.sort(function(e,t){if("undefined"===typeof e.nodename&&"undefined"===typeof t.nodename)return 0;if("undefined"===typeof e.nodename)return-1;if("undefined"===typeof t.nodename)return 1;var a=e.nodename.match(/(\d*)/g),n=t.nodename.match(/(\d*)/g),r=parseInt(a[1]),s=parseInt(a[3]),o=parseInt(n[1]),c=parseInt(n[3]);return r>o?(console.log(""),1):r<o?-1:s>c?1:s<c?-1:e.nodename.localeCompare(t.nodename)}),t.setState({loading:!1,disconnected:!1,nodes:e})}})}},{key:"nodeInfoUpdate",value:function(e){var t=this;this.setState({loading:!0}),g(e).then(function(e){if(null===e)t.setState({disconnected:!0});else{t.state.nodes.length+1===e.length&&"undefined"!==typeof t.state.masterNode.id||t.initialNodeFetch(t.state.cfg_url);for(var a=0,n=0,r=0,s=0;s<e.length;s++)for(var o=0;o<t.state.nodes.length;o++)if(e[s].id===t.state.masterNode.id)t.state.masterNode.physState=e[s].physState,t.state.masterNode.runState=e[s].runState;else if(t.state.nodes[o].id===e[s].id)switch(t.state.nodes[o].physState=e[s].physState,t.state.nodes[o].runState=e[s].runState,t.state.nodes[o].runState){case"UNKNOWN":a++;break;case"INIT":n++;break;case"SYNC":r++;break;default:a++}t.setState({loading:!1,disconnected:!1,unknown_count:a,init_count:n,sync_count:r,dsc_loaded:!0})}})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.state.disconnected&&r.a.createElement("h2",{style:{textAlign:"center",fontFamily:"Arial",color:"maroon"}},"Disconnected From Kraken"),"undefined"===typeof this.state.masterNode||!1===this.state.dsc_loaded?r.a.createElement("h3",{style:{fontFamily:"Arial"}},"Loading..."):r.a.createElement("div",{className:"cluster"},r.a.createElement(O,{data:this.state.masterNode}),r.a.createElement("div",{className:"cluster_nodelist"},this.state.nodes.map(function(e){return r.a.createElement(w,{data:e,key:e.id})}))),r.a.createElement("div",{className:"counts_area"},r.a.createElement("div",{className:"counts"},"Unknown: ",this.state.unknown_count),r.a.createElement("div",{className:"counts"},"Init: ",this.state.init_count),r.a.createElement("div",{className:"counts"},"Sync: ",this.state.sync_count)))}}]),t}(n.Component);function w(e){"undefined"===typeof e.data.physState&&(e.data.physState="UNKNOWN"),"undefined"===typeof e.data.runState&&(e.data.runState="UNKNOWN");var t=e.data.nodename,a=f(e.data.physState),n=f(e.data.runState),s=v(e.data.id),o="Name: ".concat(t,"\nUUID: ").concat(s,"\nPhysical State: ").concat(e.data.physState,"\nRun State: ").concat(e.data.runState);return r.a.createElement(_.a,{"data-popup":o,className:"square shadow animate",style:{borderTopColor:a,borderRightColor:n,borderBottomColor:n,borderLeftColor:a},to:"node/".concat(s)})}function O(e){var t=f(e.data.physState),a=(f(e.data.runState),v(e.data.id));"Name: ".concat("master","\nUUID: ").concat(a,"\nPhysical State: ").concat(e.data.physState,"\nRun State: ").concat(e.data.runState);return r.a.createElement(_.a,{className:"master_square shadow animate",style:{backgroundColor:t},to:"node/".concat(a)},"Master")}function k(){return r.a.createElement("div",{className:"legend"},r.a.createElement("div",{className:"legend_title"},"Legend"),r.a.createElement("div",{className:"row",id:"first_row"},r.a.createElement("div",{className:"value",id:"phys_text"},"Phys"),r.a.createElement("div",{className:"square",style:{borderTopColor:m.grey,borderRightColor:m.black,borderBottomColor:m.black,borderLeftColor:m.grey}}),r.a.createElement("div",{className:"value",id:"run_text"},"Run")),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"square",style:{borderColor:m.yellow}}),r.a.createElement("div",{className:"value"},"State Unknown")),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"square",style:{borderColor:m.grey}}),r.a.createElement("div",{className:"value"},"Power Off")),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"square",style:{borderColor:m.blue}}),r.a.createElement("div",{className:"value"},"Initializing")),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"square",style:{borderColor:m.green}}),r.a.createElement("div",{className:"value"},"Power On / Sync")),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"square",style:{borderColor:m.purple}}),r.a.createElement("div",{className:"value"},"Hang")),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"square",style:{borderColor:m.red}}),r.a.createElement("div",{className:"value"},"Error")))}var C=function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(b,null),r.a.createElement("div",null,r.a.createElement(k,null),r.a.createElement("div",{className:"node_area"},r.a.createElement(S,null))))}}]),t}(n.Component),j=a(11),F=a.n(j),I=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(i.a)(this,Object(d.a)(t).call(this,e))).appRef=Object(n.createRef)();var r={nodes:e.graph.nodes,edges:e.graph.edges};return a.state={data:r,options:{edges:{arrows:{to:{enabled:!0,scaleFactor:1.5}},color:{inherit:!1},width:4},nodes:{color:"#bfbfbf"},physics:{enabled:!0,barnesHut:{gravitationalConstant:-5e4}},height:"100%",width:"100%"}},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){new F.a.Network(this.appRef.current,this.state.data,this.state.options).fit(this.state.options)}},{key:"render",value:function(){return r.a.createElement("div",{className:"node_graph",ref:this.appRef})}}]),t}(n.Component);a(28);function R(){return r.a.createElement("a",{className:"title-link",href:"/"},r.a.createElement("h1",{className:"banner_title"},"Kraken"))}function x(e){var t=f(e.dscNode.physState),a=f(e.dscNode.runState);return r.a.createElement("div",{className:"large_square",style:{borderTopColor:t,borderRightColor:a,borderBottomColor:a,borderLeftColor:t}})}function P(e){var t=e.dscNode.runState,a=e.cfgNode.runState,n=e.dscNode.physState,s=e.cfgNode.physState,o=v(e.cfgNode.id);if(null!==e.cfgNode.parentId&&"undefined"!==typeof e.cfgNode.parentId)var c=v(e.cfgNode.parentId);else{c="";e.cfgNode.nodename="Master"}for(var l=[],i=[],d=0;d<e.cfgNode.extensions.length;d++)l.push(e.cfgNode.extensions[d]);l.sort(function(e,t){return q(e["@type"])<q(t["@type"])?-1:q(e["@type"])>q(t["@type"])?1:0});for(d=0;d<l.length;d++)Object.keys(l[d]).length>1&&i.push(r.a.createElement(U,{extension:l[d],key:d}));return r.a.createElement("div",{className:"node_detail"},r.a.createElement("h1",{className:"node_title"},e.cfgNode.nodename),r.a.createElement("div",{className:"non_bordered_detail"},r.a.createElement("div",{className:"node_view_row"},r.a.createElement("div",{className:"node_view_key"},"Node ID:"),r.a.createElement("div",{className:"node_view_value"},o)),r.a.createElement("div",{className:"node_view_row"},r.a.createElement("div",{className:"node_view_key"},"Parent ID:"),r.a.createElement("div",{className:"node_view_value"},c)),r.a.createElement("div",{className:"node_view_row"},r.a.createElement("div",{className:"node_view_key"},"Physical State:"),r.a.createElement("div",{className:"node_view_value"},n," / ",s)),r.a.createElement("div",{className:"node_view_row"},r.a.createElement("div",{className:"node_view_key"},"Run State:"),r.a.createElement("div",{className:"node_view_value"},t," / ",a)),r.a.createElement("div",{className:"node_view_row"},r.a.createElement("div",{className:"node_view_key"},"Architecture:"),r.a.createElement("div",{className:"node_view_value"},e.cfgNode.arch)),r.a.createElement("div",{className:"node_view_row"},r.a.createElement("div",{className:"node_view_key"},"Platform:"),r.a.createElement("div",{className:"node_view_value"},e.cfgNode.platform))),i)}function U(e){for(var t=q(e.extension["@type"]),a=[],n=Object.keys(e.extension),s=0;s<n.length;s++){var o=n[s];"@type"!==o&&a.push(A(e.extension[o],o,0))}return r.a.createElement("div",{className:"bordered_detail"},r.a.createElement("div",{className:"info_title"},t),a)}function A(e,t,a){a++;var n=[];if(Array.isArray(e)){n.push(W(t,a));for(var r=0;r<e.length;r++)n.push(A(e[r],r,a))}else if("object"===typeof e){n.push(W(t,a));for(var s=Object.keys(e),o=0;o<s.length;o++){var c=s[o];n.push(A(e[c],c,a))}}else"boolean"===typeof e?n.push(W(t,a,e.toString())):n.push(W(t,a,function(e,t){switch(!0){case e.includes("ip"):return N(t);case e.includes("mac"):return function(e){var t=p(e);return t=t.replace(/(.{2})(.{2})(.{2})(.{2})(.{2})(.{2})/,"$1:$2:$3:$4:$5:$6")}(t);case e.includes("subnet"):return N(t);default:return t}}(t,e)));return n}function W(e,t,a){var n=(15*(t-1)).toString()+"px";return r.a.createElement("div",{style:{paddingLeft:n},className:"node_view_row"},r.a.createElement("span",{className:"node_view_key"},e,":"),r.a.createElement("span",{className:"node_view_value"},a))}function $(e){return r.a.createElement("div",{className:"actions_area ".concat("undefined"===typeof e.cfgNode.parentId?"hidden":"")},r.a.createElement("div",{className:"button green",onClick:function(){!function(e,t,a,n){t.runState="SYNC",t.physState="POWER_ON";for(var r=0;r<t.extensions.length;r++)"type.googleapis.com/proto.PXE"===t.extensions[r]["@type"]&&(t.extensions[r].state="INIT");E(n,t)}(e.dscNode,e.cfgNode,e.dscUrl,e.cfgUrl)}},"Power On"),r.a.createElement("div",{className:"button red",onClick:function(){!function(e,t,a,n){t.physState="POWER_OFF",t.runState="UNKNOWN";for(var r=0;r<t.extensions.length;r++)"type.googleapis.com/proto.PXE"===t.extensions[r]["@type"]?t.extensions[r].state="NONE":"type.googleapis.com/proto.RPi3"===t.extensions[r]["@type"]&&(t.extensions[r].pxe="NONE");for(e.runState="UNKNOWN",e.physState="PHYS_HANG",r=0;r<e.extensions.length;r++)"type.googleapis.com/proto.PXE"===e.extensions[r]["@type"]?e.extensions[r].state="NONE":"type.googleapis.com/proto.RPi3"===e.extensions[r]["@type"]&&(e.extensions[r].pxe="NONE");E(a,e),E(n,t)}(e.dscNode,e.cfgNode,e.dscUrl,e.cfgUrl)}},"Power Off"))}function q(e){return e.replace("type.googleapis.com/proto.","")}var K=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(i.a)(this,Object(d.a)(t).call(this,e))).state={dsc_url:"http://".concat(h,"/dsc/node/").concat(e.match.params.uuid),cfg_url:"http://".concat(h,"/cfg/node/").concat(e.match.params.uuid),graph_url:"http://".concat(h,"/graph/node/").concat(e.match.params.uuid,"/json"),refreshRate:400,dscNode:{},cfgNode:{},graph:{},disconnected:!0},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.interval=window.setInterval(function(){e.dscFetch(e.state.dsc_url),e.graphFetch(e.state.graph_url)},this.state.refreshRate),this.cfgFetch(this.state.cfg_url),this.graphFetch(this.state.dscFetch),this.dscFetch(this.state.dsc_url)}},{key:"dscFetch",value:function(e){var t=this;y(e).then(function(e){null===e?t.setState({disconnected:!0}):t.setState({dscNode:e})})}},{key:"cfgFetch",value:function(e){var t=this;y(e).then(function(e){null===e?t.setState({disconnected:!0}):t.setState({cfgNode:e})})}},{key:"graphFetch",value:function(e){var t=this;y(e).then(function(e){t.setState({graph:e})})}},{key:"render",value:function(){return 0===Object.keys(this.state.dscNode).length||0===Object.keys(this.state.cfgNode).length?console.log("DSC or CFG file did not download correctly. Trying again..."):!0===this.state.disconnected&&this.setState({disconnected:!1}),r.a.createElement(r.a.Fragment,null,r.a.createElement(R,null),this.state.disconnected?r.a.createElement("h3",{style:{fontFamily:"Arial"}},"Loading..."):r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(x,{dscNode:this.state.dscNode,cfgNode:this.state.cfgNode}),r.a.createElement(P,{dscNode:this.state.dscNode,cfgNode:this.state.cfgNode}),r.a.createElement($,{dscNode:this.state.dscNode,cfgNode:this.state.cfgNode,dscUrl:this.state.dsc_url,cfgUrl:this.state.cfg_url})),r.a.createElement("div",{style:{display:"block"}},null!==this.state.graph&&r.a.createElement(I,{graph:this.state.graph}))))}}]),t}(n.Component),D=a(38),T=a(37),H=function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(D.a,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(T.a,{exact:!0,path:"/",component:C}),r.a.createElement(T.a,{path:"/node/:uuid",component:K})))}}]),t}(n.Component);o.a.render(r.a.createElement(H,null),document.getElementById("root"))}},[[16,2,1]]]);
//# sourceMappingURL=main.04898f2f.chunk.js.map