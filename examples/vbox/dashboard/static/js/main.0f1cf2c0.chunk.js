(this["webpackJsonpkraken-dashboard"]=this["webpackJsonpkraken-dashboard"]||[]).push([[0],{112:function(e,t,o){e.exports=o(291)},117:function(e,t,o){},118:function(e,t,o){},119:function(e,t,o){},120:function(e,t,o){},121:function(e,t,o){},122:function(e,t,o){},128:function(e,t,o){},291:function(e,t,o){"use strict";o.r(t);var n=o(0),a=o.n(n),r=o(107),c=o.n(r),s=(o(71),o(7)),l=o(13),i=o(9),u=o(8),d=o(10),p=(o(117),o(118),o(119),o(120),o(121),o(122),"192.168.57.10:3141"),f=.4,h=!0,g="http://".concat(p,"/dsc/nodes"),m="http://".concat(p,"/cfg/nodes"),v="http://".concat(p,"/dsc/node"),C="http://".concat(p,"/cfg/node"),b=("http://".concat(p,"/graph/json"),"http://".concat(p,"/ws")),N="http://".concat(p,"/enumerables"),E=function(e){return"http://".concat(p,"/graph/node/").concat(e,"/json")},y={red:window.getComputedStyle(document.documentElement).getPropertyValue("--red"),purple:window.getComputedStyle(document.documentElement).getPropertyValue("--purple"),grey:window.getComputedStyle(document.documentElement).getPropertyValue("--grey"),yellow:window.getComputedStyle(document.documentElement).getPropertyValue("--yellow"),blue:window.getComputedStyle(document.documentElement).getPropertyValue("--blue"),green:window.getComputedStyle(document.documentElement).getPropertyValue("--green"),black:window.getComputedStyle(document.documentElement).getPropertyValue("--black"),titleRed:window.getComputedStyle(document.documentElement).getPropertyValue("--title-red"),borderGrey:window.getComputedStyle(document.documentElement).getPropertyValue("--border-grey"),lightGrey:window.getComputedStyle(document.documentElement).getPropertyValue("--light-grey")},O={TOP:{category:"PhysState",DSCorCFG:"DSC",valuesToColor:new Map([["POWER_ON",{enum:2,color:y.green}],["PHYS_UNKNOWN",{enum:0,color:y.yellow}],["POWER_OFF",{enum:1,color:y.grey}],["POWER_CYCLE",{enum:3,color:y.purple}],["PHYS_HANG",{enum:4,color:y.purple}],["PHYS_ERROR",{enum:5,color:y.red}]])},RIGHT:{category:"RunState",DSCorCFG:"DSC",valuesToColor:new Map([["INIT",{enum:1,color:y.blue}],["UNKNOWN",{enum:0,color:y.yellow}],["SYNC",{enum:2,color:y.green}],["ERROR",{enum:3,color:y.red}]])},LEFT:{category:"PhysState",DSCorCFG:"DSC",valuesToColor:new Map([["POWER_ON",{enum:2,color:y.green}],["PHYS_UNKNOWN",{enum:0,color:y.yellow}],["POWER_OFF",{enum:1,color:y.grey}],["POWER_CYCLE",{enum:3,color:y.purple}],["PHYS_HANG",{enum:4,color:y.purple}],["PHYS_ERROR",{enum:5,color:y.red}]])},BOTTOM:{category:"RunState",DSCorCFG:"DSC",valuesToColor:new Map([["INIT",{enum:1,color:y.blue}],["UNKNOWN",{enum:0,color:y.yellow}],["SYNC",{enum:2,color:y.green}],["ERROR",{enum:3,color:y.red}]])},BORDER:{category:"PhysState",DSCorCFG:"DSC",valuesToColor:new Map([["POWER_ON",{enum:2,color:y.green}],["PHYS_UNKNOWN",{enum:0,color:y.yellow}],["POWER_OFF",{enum:1,color:y.grey}],["POWER_CYCLE",{enum:3,color:y.purple}],["PHYS_HANG",{enum:4,color:y.purple}],["PHYS_ERROR",{enum:5,color:y.red}]])}},S=o(23),w=o(27);function k(e){return a.a.createElement("div",{className:"header"},a.a.createElement(S.b,{to:"/",className:"header-link"},a.a.createElement("div",{className:"header-text"},"Kraken")),a.a.createElement(R,{refreshRate:e.refreshRate,handleRefreshChange:e.handleRefreshChange,useWebSocket:e.useWebSocket,handleWebsocketChange:e.handleWebsocketChange}))}var R=function(e){function t(e){var o;return Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).buttonRef=null,o.closeMenu=function(){o.setState({menuOpen:!1})},o.state={menuOpen:!1},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"toggleMenu",value:function(){this.setState({menuOpen:!this.state.menuOpen})}},{key:"render",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement("svg",{ref:function(t){return e.buttonRef=t},onClick:function(){e.toggleMenu()},className:"settings",id:"settings-button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},a.a.createElement("path",{fill:"none",d:"M0 0h20v20H0V0z"}),a.a.createElement("path",{fill:y.titleRed,d:"M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"})),a.a.createElement(T,{buttonRef:this.buttonRef,menuOpen:this.state.menuOpen,refreshRate:this.props.refreshRate,handleRefreshChange:this.props.handleRefreshChange,useWebSocket:this.props.useWebSocket,handleWebsocketChange:this.props.handleWebsocketChange,closeMenu:this.closeMenu}))}}]),t}(a.a.Component),T=function(e){function t(e){var o;Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).modalRef=null,o.handleClick=function(e){null===o.modalRef||o.modalRef.contains(e.target)||null===o.props.buttonRef||o.props.buttonRef.contains(e.target)||o.props.closeMenu()};return o.state={openTop:"7rem",closedTop:"6rem",style:{opacity:o.props.menuOpen?100:0,visibility:o.props.menuOpen?"visible":"hidden",top:o.props.menuOpen?"7rem":"6rem"}},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){document.addEventListener("mousedown",this.handleClick,!1),e.menuOpen!==this.props.menuOpen&&this.setState({style:{opacity:this.props.menuOpen?100:0,visibility:this.props.menuOpen?"visible":"hidden",top:this.props.menuOpen?this.state.openTop:this.state.closedTop}})}},{key:"render",value:function(){var e=this;return a.a.createElement("form",{className:"settings",id:"settings-modal",style:this.state.style,ref:function(t){return e.modalRef=t}},a.a.createElement("div",{className:"settings-row"},a.a.createElement("label",null,"Reconnect Rate:"),a.a.createElement("input",{id:"slider",name:"refreshRate",type:"range",min:"0.15",max:"2",value:this.props.refreshRate,onChange:function(t){e.props.handleRefreshChange(parseFloat(t.target.value))},step:".05"}),a.a.createElement("div",{id:"slider-output"},this.props.refreshRate)),a.a.createElement("div",{className:"settings-row"},a.a.createElement("label",null,"Websocket:"),a.a.createElement("input",{style:{margin:"auto 7px"},name:"websocket",type:"checkbox",checked:this.props.useWebSocket,onChange:function(){e.props.handleWebsocketChange(!e.props.useWebSocket)}})),a.a.createElement("div",{className:"settings-row"},a.a.createElement(S.b,{to:"/settings",style:{textDecoration:"none"}},a.a.createElement("div",{onClick:this.props.closeMenu,id:"color-settings-button",className:"button"},"Color Settings"))))}}]),t}(a.a.Component),A=o(4),j=o(14),x=o(110),F=o(6),I=o.n(F),M=o(20),P=function(){var e=Object(M.a)(I.a.mark((function e(t){var o,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).catch((function(e){return null}));case 2:if(null===(o=e.sent)){e.next=10;break}return e.next=6,o.json();case 6:return n=e.sent,e.abrupt("return",n.nodes);case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=Object(M.a)(I.a.mark((function e(t,o){var n,a,r,c,s,l;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([fetch(t),fetch(o)]);case 2:if(n=e.sent,a=Object(A.a)(n,2),r=a[0],c=a[1],null!==r&&null!==c){e.next=10;break}return e.abrupt("return",null);case 10:return e.next=12,r.json();case 12:return s=e.sent,e.next=15,c.json();case 15:return l=e.sent,e.abrupt("return",[s.nodes,l.nodes]);case 17:case"end":return e.stop()}}),e)})));return function(t,o){return e.apply(this,arguments)}}(),D=function(){var e=Object(M.a)(I.a.mark((function e(t){var o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).catch((function(e){return null}));case 2:if(null===(o=e.sent)){e.next=7;break}return e.abrupt("return",o.json());case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function G(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function H(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?G(Object(o),!0).forEach((function(t){Object(x.a)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):G(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var U=function(){var e=Object(M.a)(I.a.mark((function e(t){var o,n,a,r,c;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Map,n={},e.next=4,P(t);case 4:if(null!==(a=e.sent)){e.next=9;break}return e.abrupt("return",{masterNode:null,computeNodes:null});case 9:for(r=0;r<a.length;r++)null===a[r].parentId||void 0===a[r].parentId?n=a[r]:void 0!==(c=a[r].id)&&o.set(c,a[r]);case 10:return e.abrupt("return",{masterNode:n,computeNodes:o});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(M.a)(I.a.mark((function e(t,o){var n,a,r,c,s;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Map,a={},e.next=4,P(t);case 4:if(null!==(r=e.sent)){e.next=9;break}return e.abrupt("return",{masterNode:null,computeNodes:null});case 9:for(c=0;c<r.length;c++)r[c].id===o?a=r[c]:void 0!==(s=r[c].id)&&n.set(s,r[c]);case 10:return e.abrupt("return",{masterNode:a,computeNodes:n});case 11:case"end":return e.stop()}}),e)})));return function(t,o){return e.apply(this,arguments)}}(),V=function(){var e=Object(M.a)(I.a.mark((function e(t,o){var n,a,r,c,s,l,i,u,d,p,f;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t,o);case 2:if(null===(n=e.sent)){e.next=15;break}for(a=n[0],r=n[1],c={},s={},l=new Map,i=new Map,u=0;u<a.length;u++)null===a[u].parentId||void 0===a[u].parentId?c=a[u]:void 0!==(d=a[u].id)&&l.set(d,a[u]);for(p=0;p<r.length;p++)r[p].id===c.id?s=r[p]:void 0!==(f=r[p].id)&&i.set(f,r[p]);return e.abrupt("return",{cfgMasterNode:c,cfgComputeNodes:l,dscMasterNode:s,dscComputeNodes:i});case 15:return e.abrupt("return",{cfgMasterNode:null,cfgComputeNodes:null,dscMasterNode:null,dscComputeNodes:null});case 16:case"end":return e.stop()}}),e)})));return function(t,o){return e.apply(this,arguments)}}(),B=function(e,t){if(void 0===e.nodename&&void 0===t.nodename)return 0;if(void 0===e.nodename)return-1;if(void 0===t.nodename)return 1;var o=e.nodename.match(/(\d*)/g),n=t.nodename.match(/(\d*)/g),a=void 0,r=void 0,c=void 0,s=void 0;return null!==o&&(a=parseInt(o[1]),r=parseInt(o[3])),null!==n&&(c=parseInt(n[1]),s=parseInt(n[3])),void 0!==a&&void 0!==c&&a>c?1:void 0!==a&&void 0!==c&&a<c?-1:void 0!==r&&void 0!==s&&r>s?1:void 0!==r&&void 0!==s&&r<s?-1:e.nodename.localeCompare(t.nodename)},_=function(e){return"PHYS_ERROR"===e||"ERROR"===e||"POWER_CYCLE"===e?y.red:"PHYS_HANG"===e?y.purple:"POWER_OFF"===e?y.grey:"PHYS_UNKNOWN"===e||"UNKNOWN"===e?y.yellow:"INIT"===e?y.blue:"SYNC"===e||"POWER_ON"===e?y.green:y.yellow},K=function(e,t,o){var n=new Map;return n.set("TOP",_(t.physState)),n.set("RIGHT",_(t.runState)),n.set("BOTTOM",_(t.runState)),n.set("LEFT",_(t.physState)),n.set("BORDER",_(t.physState)),void 0!==o&&Object.entries(o).forEach((function(o){var a=Object(A.a)(o,2),r=a[0],c=a[1],s=r,l=c;"PhysState"===l.category?l.valuesToColor.forEach((function(o,a){if("CFG"===l.DSCorCFG){if(a===e.physState)n.set(s,o.color);else if(void 0===t.runState){var r=y.black;l.valuesToColor.forEach((function(e){0===e.enum&&(r=e.color)})),n.set(s,r)}}else if(a===t.physState)n.set(s,o.color);else if(void 0===t.runState){var c=y.black;l.valuesToColor.forEach((function(e){0===e.enum&&(c=e.color)})),n.set(s,c)}})):"RunState"===l.category?l.valuesToColor.forEach((function(o,a){if("CFG"===l.DSCorCFG){if(a===e.runState)n.set(s,o.color);else if(void 0===t.runState){var r=y.black;l.valuesToColor.forEach((function(e){0===e.enum&&(r=e.color)})),n.set(s,r)}}else if(a===t.runState)n.set(s,o.color);else if(void 0===t.runState){var c=y.black;l.valuesToColor.forEach((function(e){0===e.enum&&(c=e.color)})),n.set(s,c)}})):"CFG"===l.DSCorCFG?void 0!==e.extensions&&e.extensions.forEach((function(e){var t=te(ee(l.category));if(ee(e["@type"])===t[0]){var o=q(e,0,t);if(void 0!==o)l.valuesToColor.forEach((function(e,t){t===o&&n.set(s,e.color)}));else{var a=y.black;l.valuesToColor.forEach((function(e){0===e.enum&&(a=e.color)})),n.set(s,a)}}})):void 0!==t.extensions&&t.extensions.forEach((function(e){var t=te(ee(l.category));if(ee(e["@type"])===t[0]){var o=q(e,0,t);if(void 0!==o)l.valuesToColor.forEach((function(e,t){t===o&&n.set(s,e.color)}));else{var a=y.black;l.valuesToColor.forEach((function(e){0===e.enum&&(a=e.color)})),n.set(s,a)}}}))})),n},Y=function(e,t){if(void 0!==e.id){if(Q(t.nodeid)===e.id)return z(t.url,e,t.value);console.error("node id does not match",t.nodeid.toUpperCase(),e.id.toUpperCase())}else console.error("node id is undefined")},q=function e(t,o,n){if(o!==n.length){var a=t[n[o].toLowerCase()];return void 0===a?e(t,o+1,n):a}},z=function(e,t,o){var n=!1,a=te(e);if(a[0].includes("type.googleapis.com")){var r=a[0]+"/"+a[1];a=a.slice(2,a.length),void 0!==t.extensions&&t.extensions.forEach((function(e){if(e["@type"]===r){var c=function(e,t,o,n){if(t!==o.length){if(t===o.length-1)return e[o[t].toLowerCase()]=n,e;var a=e[o[t].toLowerCase()];return void 0===a?a:q(a,t+1,o)}}(e,0,a,o);if(void 0!==c)return e=c,n=!0,t}}))}return n?t:void 0},$=function(e){for(var t=atob(e),o="",n=0;n<t.length;n++){var a=t.charCodeAt(n).toString(16);o+=2===a.length?a:"0"+a}return o.toUpperCase()},J=function(e){var t="";try{t=atob(e)}catch(r){return e}for(var o="",n=0;n<t.length;n++){var a=t.charCodeAt(n).toString(10);o+=0===n?a:"."+a}return o},X=function(e){if(void 0!==e){var t=$(e);return t=t.replace(/(.{8})(.{4})(.{4})(.{4})(.{10})/,"$1-$2-$3-$4-$5")}return""},Q=function(e){return function(e){var t=e.match(/.{1,2}/g),o="";if(null!==t)for(var n=0;n<t.length;n++)o+=String.fromCharCode(parseInt(t[n],16));return btoa(o)}(e.replace(/-/g,""))},Z=function(e,t){switch(!0){case e.includes("ip"):return J(t);case e.includes("mac"):return function(e){var t=$(e);return t=t.replace(/(.{2})(.{2})(.{2})(.{2})(.{2})(.{2})/,"$1:$2:$3:$4:$5:$6")}(t);case e.includes("subnet"):return J(t);default:return t}},ee=function(e){return e.replace("type.googleapis.com/","").replace("proto.","")},te=function(e){return e.split(/[/,_]+/)},oe=function(e,t,o){return fetch(e,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)}).then((function(e){return e.json()})).then(o).catch((function(e){return console.error("putNode error:",e)}))},ne=function(e,t){var o=Object(j.cloneDeep)(e),n=new Map,a=new Map;if(void 0!==t){if(void 0!==o.extensions){for(var r=0;r<o.extensions.length;r++)n.set(o.extensions[r]["@type"],o.extensions[r]);if(void 0!==t.extensions)for(var c=0;c<t.extensions.length;c++){var s=n.get(t.extensions[c]["@type"]);if(void 0!==s){var l=H({},s,{},t.extensions[c]);n.set(s["@type"],l)}else n.set(t.extensions[c]["@type"],t.extensions[c])}}if(void 0!==o.services){for(var i=0;i<o.services.length;i++)a.set(o.services[i].id,o.services[i]);if(void 0!==t.services)for(var u=0;u<t.services.length;u++){var d=a.get(t.services[u].id);if(void 0!==d){var p=H({},d,{},t.services[u]);a.set(d.id,p)}else a.set(t.services[u].id,t.services[u])}}}return o.physState=t.physState,o.runState=t.runState,o.extensions=Array.from(n.values()),o.services=Array.from(a.values()),o},ae=function(e){function t(e){var o;return Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).leftText=void 0,o.rightText=void 0,o.sortCategories=function(e){var t=[];return e.forEach((function(e,o){var n=Object(j.cloneDeep)(e);n.category=o,t.push(n)})),t=t.sort((function(e,t){return e.category.localeCompare(t.category)}))},o.componentDidMount=function(){o.leftText.current.offsetWidth>o.rightText.current.offsetWidth?o.setState({rightWidth:o.leftText.current.offsetWidth+7}):o.leftText.current.offsetWidth<o.rightText.current.offsetWidth&&o.setState({leftWidth:o.rightText.current.offsetWidth+7})},o.render=function(){var e=new Map,t=Object(j.cloneDeep)(o.props.colorInfo);Object.entries(t).forEach((function(o){var n=Object(A.a)(o,2),a=n[0],r=n[1];e.set(r.category,r),Object.entries(t).forEach((function(t){var o=Object(A.a)(t,2),n=o[0],c=o[1];a!==n&&c.category===r.category&&c.DSCorCFG!==r.DSCorCFG&&(e.set("".concat(r.category,"(").concat(r.DSCorCFG,")"),r),e.delete(r.category))}))})),Object.entries(o.props.colorInfo).forEach((function(o){var n=Object(A.a)(o,2),a=n[0],r=n[1],c=a;void 0===e.get(r.category)&&e.forEach((function(e,o){r.category===e.category&&r.DSCorCFG===e.DSCorCFG&&(t[c].category=o)}))}));var n=o.sortCategories(e);return a.a.createElement("div",{className:"legend"},a.a.createElement("div",{className:"legend-title"},"Legend"),a.a.createElement("div",{className:"row",id:"first-row"},a.a.createElement("div",{id:"top-text"},ee(t.TOP.category).charAt(0).toUpperCase()+ee(t.TOP.category).slice(1)),a.a.createElement("div",{id:"middle-row"},a.a.createElement("div",{id:"left-text",ref:o.leftText,style:null!==o.state.leftWidth?{width:"".concat(o.state.leftWidth,"px")}:{}},ee(t.LEFT.category).charAt(0).toUpperCase()+ee(t.LEFT.category).slice(1)),a.a.createElement("div",{className:"square-border",style:{backgroundColor:Array.from(t.BORDER.valuesToColor.values())[0].color}},a.a.createElement("div",{className:"square",style:{borderTopColor:Array.from(t.TOP.valuesToColor.values())[0].color,borderRightColor:Array.from(t.RIGHT.valuesToColor.values())[0].color,borderBottomColor:Array.from(t.BOTTOM.valuesToColor.values())[0].color,borderLeftColor:Array.from(t.LEFT.valuesToColor.values())[0].color,width:"0%"}})),a.a.createElement("div",{id:"right-text",ref:o.rightText,style:null!==o.state.rightWidth?{width:"".concat(o.state.rightWidth,"px")}:{}},ee(t.RIGHT.category).charAt(0).toUpperCase()+ee(t.RIGHT.category).slice(1))),a.a.createElement("div",{id:"bottom-text"},ee(t.BOTTOM.category).charAt(0).toUpperCase()+ee(t.BOTTOM.category).slice(1)),a.a.createElement("div",{id:"border-text"},ee(t.BORDER.category).charAt(0).toUpperCase()+ee(t.BORDER.category).slice(1))),n.map((function(e){return a.a.createElement(re,{nodeColorInfoArea:e,key:e.category})})))},o.leftText=a.a.createRef(),o.rightText=a.a.createRef(),o.state={leftWidth:void 0,rightWidth:void 0},o}return Object(d.a)(t,e),t}(n.Component),re=function(e){return a.a.createElement("div",null,a.a.createElement("div",{className:"legend-category-title"},"".concat(ee(e.nodeColorInfoArea.category).charAt(0).toUpperCase()+ee(e.nodeColorInfoArea.category).slice(1),":")),Array.from(e.nodeColorInfoArea.valuesToColor.entries()).map((function(e){var t=Object(A.a)(e,2),o=t[0],n=t[1];return a.a.createElement("div",{className:"legend-color-value-row",key:n.enum},a.a.createElement("div",{className:"legend-color",style:{backgroundColor:n.color}}),a.a.createElement("div",{className:"legend-value"},o))})))},ce=function(e){var t=_(e.dsc.physState),o=X(e.dsc.id);return a.a.createElement(S.b,{className:"master-square-border",style:{backgroundColor:se(t,-30)},to:"node/".concat(o)},a.a.createElement("div",{className:"master-square",style:{backgroundColor:t}},"Master"))},se=function(e,t){var o=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16),a=parseInt(e.substring(6,8),16);return o=Math.round(o*(100+t)/100),n=(n=Math.round(n*(100+t)/100))<255?n:255,a=(a=Math.round(a*(100+t)/100))<255?a:255,"#"+(1===(o=o<255?o:255).toString(16).length?"0"+o.toString(16):o.toString(16))+(1===n.toString(16).length?"0"+n.toString(16):n.toString(16))+(1===a.toString(16).length?"0"+a.toString(16):a.toString(16))},le=function(e){void 0===e.dsc.physState&&(e.dsc.physState="PHYS_UNKNOWN"),void 0===e.dsc.runState&&(e.dsc.runState="UNKNOWN");var t=e.cfg.nodename,o=X(e.cfg.id),n=K(e.cfg,e.dsc,e.colorInfo),r="Name: ".concat(t,"\nUUID: ").concat(o,"\nPhysical State: ").concat(e.dsc.physState,"\nRun State: ").concat(e.dsc.runState);return a.a.createElement(S.b,{"data-popup":r,className:"square-border",to:"node/".concat(o),style:{backgroundColor:n.get("BORDER")}},a.a.createElement("div",{className:"square",style:{borderTopColor:n.get("TOP"),borderRightColor:n.get("RIGHT"),borderBottomColor:n.get("BOTTOM"),borderLeftColor:n.get("LEFT")}}))},ie=function(e){function t(){var e,o;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(o=Object(i.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).stateCount=function(e){var t=0,o=0,n=0;return e.forEach((function(e){switch(e.runState){case"UNKNOWN":t++;break;case"INIT":o++;break;case"SYNC":n++;break;default:t++}})),{unknownCount:t,initCount:o,syncCount:n}},o.componentDidMount=function(){o.props.opened()},o.render=function(){var e=o.stateCount(o.props.dscNodes);return a.a.createElement(a.a.Fragment,null,o.props.disconnected&&a.a.createElement("h2",{style:{textAlign:"center",fontFamily:"Arial",color:"maroon"}},"Disconnected From Kraken"),0===o.props.dscNodes.size&&void 0===o.props.cfgMasterNode.id?a.a.createElement("h3",{style:{fontFamily:"Arial"}},"Loading..."):a.a.createElement("div",{className:"cluster"},a.a.createElement(ce,{dsc:o.props.dscMasterNode,cfg:o.props.cfgMasterNode}),a.a.createElement("div",{className:"cluster-nodelist"},Array.from(o.props.dscNodes.values()).map((function(e){if(void 0!==e.id){var t=o.props.cfgNodes.get(e.id);if(void 0!==t)return a.a.createElement(le,{cfg:t,dsc:e,key:e.id,colorInfo:o.props.colorInfo})}return a.a.createElement("div",null)})))),a.a.createElement("div",{className:"counts-area"},a.a.createElement("div",{className:"counts"},"Unknown: ",e.unknownCount),a.a.createElement("div",{className:"counts"},"Init: ",e.initCount),a.a.createElement("div",{className:"counts"},"Sync: ",e.syncCount)))},o}return Object(d.a)(t,e),t}(n.Component);function ue(e){return a.a.createElement("div",{className:"dashboard"},a.a.createElement(ae,{colorInfo:e.colorInfo}),a.a.createElement("div",{className:"node-area"},a.a.createElement(ie,{opened:e.opened,disconnected:e.disconnected,cfgMasterNode:e.cfgMasterNode,dscMasterNode:e.dscMasterNode,cfgNodes:e.cfgNodes,dscNodes:e.dscNodes,colorInfo:e.colorInfo})),a.a.createElement("div",{className:"buffer-area"}))}var de=function(e){void 0===e.dscNode.physState&&(e.dscNode.physState="PHYS_UNKNOWN"),void 0===e.dscNode.runState&&(e.dscNode.runState="UNKNOWN");var t=K(e.cfgNode,e.dscNode,e.colorInfo);return a.a.createElement("div",{className:"large-square-border",style:{backgroundColor:t.get("BORDER")}},a.a.createElement("div",{className:"large-square",style:{borderTopColor:t.get("TOP"),borderRightColor:t.get("RIGHT"),borderBottomColor:t.get("BOTTOM"),borderLeftColor:t.get("LEFT")}}))},pe=o(24),fe=(o(128),function(e){var t=void 0!==e.dscNode.runState?e.dscNode.runState:"",o=void 0!==e.cfgNode.runState?e.cfgNode.runState:"",n=void 0!==e.dscNode.physState?e.dscNode.physState:"",r=void 0!==e.cfgNode.physState?e.cfgNode.physState:"",c=X(e.cfgNode.id),s="";null!==e.cfgNode.parentId&&void 0!==e.cfgNode.parentId?s=X(e.cfgNode.parentId):e.cfgNode.nodename="Master";var l=void 0!==e.cfgNode.arch?e.cfgNode.arch:"",i=void 0!==e.cfgNode.platform?e.cfgNode.platform:"",u=ve("Node ID",0,c),d=""!==s?ve("Parent ID",0,s):a.a.createElement(a.a.Fragment,null),p=Ce("Physical State",r,n),f=Ce("Run State",o,t),h=""!==l?ve("Architecture",0,l):a.a.createElement(a.a.Fragment,null),g=""!==i?ve("Platform",0,i):a.a.createElement(a.a.Fragment,null),m=ne(e.cfgNode,e.dscNode),v=he(m.extensions,"@type"),C=he(m.services,"id"),b=he(e.cfgNode.extensions,"@type"),N=he(e.cfgNode.services,"id"),E=he(e.dscNode.extensions,"@type"),y=he(e.dscNode.services,"id");return a.a.createElement("div",{className:"node-detail"},a.a.createElement("h1",{className:"node-title"},e.cfgNode.nodename),a.a.createElement("div",{className:"non-bordered-detail"},u,d,p,f,h,g),a.a.createElement(pe.d,null,a.a.createElement(pe.b,null,a.a.createElement(pe.a,null,"Mixed"),a.a.createElement(pe.a,null,"CFG"),a.a.createElement(pe.a,null,"DSC")),a.a.createElement(pe.c,null,v.length>0?a.a.createElement("h2",null,"Extensions:"):a.a.createElement(a.a.Fragment,null),v,C.length>0?a.a.createElement("h2",null,"Services:"):a.a.createElement(a.a.Fragment,null),C),a.a.createElement(pe.c,null,b.length>0?a.a.createElement("h2",null,"Extensions:"):a.a.createElement(a.a.Fragment,null),b,N.length>0?a.a.createElement("h2",null,"Services:"):a.a.createElement(a.a.Fragment,null),N),a.a.createElement(pe.c,null,E.length>0?a.a.createElement("h2",null,"Extensions:"):a.a.createElement(a.a.Fragment,null),E,y.length>0?a.a.createElement("h2",null,"Services:"):a.a.createElement(a.a.Fragment,null),y)))}),he=function(e,t){var o=[];if(void 0!==e){e.sort((function(e,o){return ee(e[t])<ee(o[t])?-1:ee(e[t])>ee(o[t])?1:0}));for(var n=0;n<e.length;n++)o.push(a.a.createElement(ge,{extSrv:e[n],key:n,id:t}))}return o},ge=function(e){for(var t=ee(e.extSrv[e.id]),o=[],n=0,r=Object.keys(e.extSrv);n<r.length;n++){var c=r[n];c!==e.id&&o.push(me(e.extSrv[c],c,0))}return 0===o.length?a.a.createElement("div",null,a.a.createElement("div",{className:"info-title-single"},t)):a.a.createElement("div",{className:"bordered-detail"},a.a.createElement("div",{className:"info-title"},t),o)},me=function e(t,o,n){n++;var a=[];if(Array.isArray(t)){a.push(ve(o,n));for(var r=0;r<t.length;r++)a.push(e(t[r],r,n))}else if("object"===typeof t){a.push(ve(o,n));for(var c=0,s=Object.keys(t);c<s.length;c++){var l=s[c];a.push(e(t[l],l,n))}}else t===Boolean?a.push(ve(o,n,t.toString())):a.push(ve(o,n,Z(o.toString(),t.toString())));return a},ve=function(e,t,o){var n=(15*(t-1)).toString()+"px";return a.a.createElement("div",{style:{paddingLeft:n},className:"node-view-row",key:e},a.a.createElement("span",{className:"node-view-key"},e,":"),a.a.createElement("span",{className:"node-view-value"},o))},Ce=function(e,t,o){return a.a.createElement("div",{className:"cfg-dsc-row",key:e},a.a.createElement("div",{className:"cfg-dsc-title"},e,":"),a.a.createElement("div",{className:"cfg-dsc-value-row"},a.a.createElement("div",{className:"cfg-dsc-value-container"},a.a.createElement("div",{className:"cfg-dsc-key"},"CFG:"),a.a.createElement("div",{className:"cfg-dsc-value"},t)),a.a.createElement("div",{className:"cfg-dsc-value-container"},a.a.createElement("div",{className:"cfg-dsc-key"},"DSC:"),a.a.createElement("div",{className:"cfg-dsc-value"},o))))},be=function(e){return a.a.createElement("div",{className:"actions-area",style:{display:void 0===e.cfgNode.parentId?"none":""}},a.a.createElement("div",{className:"button green",onClick:function(){var t;(t=e.cfgNode).runState="SYNC",t.physState="POWER_ON",oe(C,t)}},"Power On"),a.a.createElement("div",{className:"button red",onClick:function(){!function(e,t){if(e.physState="POWER_OFF",e.runState="UNKNOWN",void 0!==e.extensions)for(var o=0;o<e.extensions.length;o++)"type.googleapis.com/proto.PXE"===e.extensions[o]["@type"]?e.extensions[o].state="NONE":"type.googleapis.com/proto.RPi3"===e.extensions[o]["@type"]&&(e.extensions[o].pxe="NONE");if(t.runState="UNKNOWN",void 0!==t.extensions)for(var n=0;n<t.extensions.length;n++)"type.googleapis.com/proto.PXE"===t.extensions[n]["@type"]?t.extensions[n].state="NONE":"type.googleapis.com/proto.RPi3"===t.extensions[n]["@type"]&&(t.extensions[n].pxe="NONE");oe(v,t,(function(){oe(C,e)}))}(e.cfgNode,e.dscNode)}},"Power Off"),a.a.createElement("div",{className:"button purple",id:"graph-button",onClick:e.graphToggle},a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100",height:"38",viewBox:"0 0 24 20"},a.a.createElement("path",{fill:"None",d:"M0 0h24v24H0V0z"}),a.a.createElement("path",{fill:"white",d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"}))))},Ne=o(49),Ee=function(e){function t(e){var o;Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).appRef=void 0,o.appRef=Object(n.createRef)();for(var a=e.graph.nodes,r=0;r<a.length;r++){var c={border:a[r].color.border,background:a[r].color.background};a[r].color.highlight=c,a[r].borderWidth=2}var l={nodes:new Ne.a.DataSet(a),edges:new Ne.a.DataSet(e.graph.edges)};return o.state={data:l,options:{edges:{arrows:{to:{enabled:!0,scaleFactor:1.5}},color:{inherit:!1},width:4},physics:{enabled:!0,barnesHut:{gravitationalConstant:-5e4}},height:"100%",width:"100%"},style:{opacity:o.props.graphOpen?100:0,visibility:o.props.graphOpen?"visible":"hidden"}},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){void 0!==this.appRef&&new Ne.a.Network(this.appRef.current,this.state.data,this.state.options).fit(this.state.options)}},{key:"componentDidUpdate",value:function(e){if(this.props.graphOpen!==e.graphOpen&&this.setState({style:{opacity:this.props.graphOpen?100:0,visibility:this.props.graphOpen?"visible":"hidden"}}),this.props.graph!==e.graph){for(var t=this.state.data,o=this.props.graph.nodes,n=0;n<o.length;n++){var a={border:o[n].color.border,background:o[n].color.background};o[n].color.highlight=a,o[n].borderWidth=2}t.nodes.update(o),t.edges.update(this.props.graph.edges),this.forceUpdate()}}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{style:this.state.style,className:"graph-area"},a.a.createElement("div",{className:"close-button",onClick:function(){e.props.graphToggle()}},a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 24 24"},a.a.createElement("path",{fill:"None",d:"M0 0h24v24H0V0z"}),a.a.createElement("path",{fill:y.grey,d:"M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"}))),a.a.createElement("div",{className:"node-graph",ref:this.appRef}))}}]),t}(n.Component),ye=function(e){function t(e){var o;return Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){o.props.opened()},o.graphToggle=function(){o.setState({graphOpen:!o.state.graphOpen})},o.state={graphOpen:!1},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,this.props.disconnected&&a.a.createElement("h2",{style:{textAlign:"center",fontFamily:"Arial",color:"maroon"}},"Disconnected From Kraken"),void 0===this.props.cfgNode||void 0===this.props.dscNode?a.a.createElement("h3",{style:{fontFamily:"Arial"}},"Node Does Not Exist"):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"node-view"},a.a.createElement(de,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode,colorInfo:this.props.colorInfo}),a.a.createElement(fe,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode}),a.a.createElement(be,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode,graphToggle:this.graphToggle})),void 0!==this.props.graph&&0!==Object.keys(this.props.graph).length&&a.a.createElement(Ee,{graph:this.props.graph,graphOpen:this.state.graphOpen,graphToggle:this.graphToggle})))}}]),t}(n.Component),Oe=o(111),Se=function(e){function t(e){var o;return Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).changeSelectedArea=function(e){o.setState({selected:e})},o.state={selected:"TOP"},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"node-color-area"},a.a.createElement(we,{selected:this.state.selected,colorInfo:this.props.currentColorConfig,changeSelectedArea:this.changeSelectedArea}),a.a.createElement(ke,{selectedArea:this.state.selected,stateOptions:this.props.nodeStateOptions,currentColorConfig:this.props.currentColorConfig,changeColorInfo:this.props.changeColorInfo}))}}]),t}(n.Component),we=function(e){var t=Array.from(e.colorInfo.BORDER.valuesToColor.values())[0].color,o=Array.from(e.colorInfo.TOP.valuesToColor.values())[0].color,n=Array.from(e.colorInfo.RIGHT.valuesToColor.values())[0].color,r=Array.from(e.colorInfo.BOTTOM.valuesToColor.values())[0].color,c=Array.from(e.colorInfo.LEFT.valuesToColor.values())[0].color;return a.a.createElement("div",{className:"area-selector-area"},a.a.createElement("div",{className:"color-square"},a.a.createElement("div",{style:"BORDER"===e.selected?{borderColor:y.red}:{borderColor:"transparent"},className:"color-square-border-border"}),a.a.createElement("div",{style:{borderColor:t},className:"color-square-border",onClick:function(){e.changeSelectedArea("BORDER")}}),a.a.createElement("div",{className:"color-square-mask"},a.a.createElement("div",{style:{backgroundColor:o},className:"color-square-top",onClick:function(){e.changeSelectedArea("TOP")}}),a.a.createElement("div",{style:{backgroundColor:n},className:"color-square-right",onClick:function(){e.changeSelectedArea("RIGHT")}}),a.a.createElement("div",{style:{backgroundColor:r},className:"color-square-bottom",onClick:function(){e.changeSelectedArea("BOTTOM")}}),a.a.createElement("div",{style:{backgroundColor:c},className:"color-square-left",onClick:function(){e.changeSelectedArea("LEFT")}})),a.a.createElement("div",{style:"TOP"===e.selected?{borderTopColor:y.red}:{borderTopColor:"transparent"},className:"color-square-top-border"}),a.a.createElement("div",{style:"RIGHT"===e.selected?{borderRightColor:y.red}:{borderRightColor:"transparent"},className:"color-square-right-border"}),a.a.createElement("div",{style:"BOTTOM"===e.selected?{borderBottomColor:y.red}:{borderBottomColor:"transparent"},className:"color-square-bottom-border"}),a.a.createElement("div",{style:"LEFT"===e.selected?{borderLeftColor:y.red}:{borderLeftColor:"transparent"},className:"color-square-left-border"})))},ke=function(e){function t(e){var o;Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).getState=function(){var e=[],t=new Map,n=[],a=new Map,r=o.props.currentColorConfig[o.props.selectedArea];return void 0!==o.props.stateOptions&&(e=o.props.stateOptions),e.forEach((function(e){n.push(e.name),e.name===r.category&&(t=e.options)})),t.forEach((function(e){o.props.currentColorConfig[o.props.selectedArea].valuesToColor.forEach((function(t,o){o===e&&a.set(e,{enum:t.enum,color:t.color})}))})),{selectedAreaInfo:r,availableCategoryNames:n,availableValues:t,currentColorsForAvailableValues:a}},o.componentDidUpdate=function(e){if(e!==o.props){var t=o.getState(),n=Array.from(t.availableValues.values())[0];void 0!==o.state.selectedValueName&&void 0!==t.currentColorsForAvailableValues.get(o.state.selectedValueName)&&(n=o.state.selectedValueName),o.setState({selectedValueName:n,selectedAreaInfo:t.selectedAreaInfo,availableCategoryNames:t.availableCategoryNames,availableValues:t.availableValues,currentColorsForAvailableValues:t.currentColorsForAvailableValues})}},o.changeSelectedValue=function(e){o.setState({selectedValueName:e})},o.handleCategoryChange=function(e){var t=Object(j.cloneDeep)(o.props.currentColorConfig),n=new Map,a=new Map,r=!1;Object.values(o.props.currentColorConfig).forEach((function(n){n.category===e&&"DSC"===n.DSCorCFG&&(r=!0,t[o.props.selectedArea].category=e,t[o.props.selectedArea].DSCorCFG="DSC",t[o.props.selectedArea].valuesToColor=n.valuesToColor)})),r||(void 0!==o.props.stateOptions&&o.props.stateOptions.forEach((function(t){t.name===e&&(a=t.options)})),a.forEach((function(e,t){n.set(e,{enum:t,color:y.grey})})),t[o.props.selectedArea].DSCorCFG="DSC",t[o.props.selectedArea].category=e,t[o.props.selectedArea].valuesToColor=n),o.props.changeColorInfo(t)},o.handleDSCCFGChange=function(e){var t=Object(j.cloneDeep)(o.props.currentColorConfig);t[o.props.selectedArea].DSCorCFG=e,Object.entries(o.props.currentColorConfig).forEach((function(n){var a=Object(A.a)(n,2),r=a[0],c=a[1];r!==o.props.selectedArea&&c.category===t[o.props.selectedArea].category&&c.DSCorCFG===e&&(t[o.props.selectedArea].valuesToColor=c.valuesToColor)})),o.props.changeColorInfo(t)},o.handleColorChange=function(e){var t=Object(j.cloneDeep)(o.props.currentColorConfig),n=new Map;t[o.props.selectedArea].valuesToColor.forEach((function(t,a){a===o.state.selectedValueName?n.set(a,{enum:t.enum,color:e.hex}):n.set(a,t)})),t[o.props.selectedArea].valuesToColor=n,Object.entries(o.props.currentColorConfig).forEach((function(e){var a=Object(A.a)(e,2),r=a[0],c=a[1],s=r;s!==o.props.selectedArea&&c.category===t[o.props.selectedArea].category&&c.DSCorCFG===t[o.props.selectedArea].DSCorCFG&&(t[s].valuesToColor=n)})),o.props.changeColorInfo(t)};var n=o.getState();return o.state={selectedValueName:Array.from(n.availableValues.values())[0],selectedAreaInfo:n.selectedAreaInfo,availableCategoryNames:n.availableCategoryNames,availableValues:n.availableValues,currentColorsForAvailableValues:n.currentColorsForAvailableValues},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;if(void 0===this.props.stateOptions)return a.a.createElement("div",null,"Could Not Get Node State Options From Kraken");var t=y.black,o=this.state.currentColorsForAvailableValues.get(this.state.selectedValueName);return void 0!==o&&(t=o.color),a.a.createElement("div",{className:"color-details-area"},a.a.createElement("h1",null,this.props.selectedArea),a.a.createElement("div",{className:"color-selection-area"},a.a.createElement("div",null,a.a.createElement("div",{className:"color-details-row"},a.a.createElement("div",{style:{display:"inline-block",margin:"auto 10px"}},"Category:"),a.a.createElement(Re,{options:this.state.availableCategoryNames,value:this.state.selectedAreaInfo.category,onChange:this.handleCategoryChange})),a.a.createElement("div",{className:"color-details-row"},a.a.createElement("div",{style:{display:"inline-block",margin:"auto 10px"}},"DSC or CFG:"),a.a.createElement(Re,{options:["DSC","CFG"],value:this.state.selectedAreaInfo.DSCorCFG,onChange:this.handleDSCCFGChange}))),a.a.createElement("div",null,Array.from(this.state.availableValues.entries()).sort(Te).map((function(t){return a.a.createElement("div",{className:"color-details-row",key:t[0],style:e.state.selectedValueName===t[1]?{borderColor:y.borderGrey,cursor:"pointer",backgroundColor:"#f0f0f0"}:{cursor:"pointer"},onClick:function(){e.changeSelectedValue(t[1])}},a.a.createElement("div",{className:"color-details-row-key",style:{display:"inline-block",margin:"auto 10px"}},"".concat(t[1],":")),a.a.createElement("div",{className:"color-details-current-square",style:{backgroundColor:Ae(e.state.currentColorsForAvailableValues,t[1])}}))}))),a.a.createElement(Oe.SketchPicker,{presetColors:Object.values(y),disableAlpha:!0,color:t,onChange:this.handleColorChange})))}}]),t}(n.Component),Re=function(e){function t(e){var o;return Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).dropDownRef=null,o.componentDidMount=function(){document.addEventListener("mousedown",o.handleClick,!1)},o.handleClick=function(e){null===o.dropDownRef||o.dropDownRef.contains(e.target)||o.setState({open:!1})},o.toggleDropDown=function(){o.setState({open:!o.state.open})},o.state={open:!1},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{ref:function(t){return e.dropDownRef=t}},a.a.createElement("div",{className:this.state.open?"dropdown-button active":"dropdown-button",onClick:this.toggleDropDown},this.props.value.replace("proto.",""),a.a.createElement("span",{className:"arrow"})),a.a.createElement("div",{className:"dropdown-options"},this.props.options.map((function(t){return a.a.createElement("div",{key:t,className:e.state.open?"dropdown-option active":"dropdown-option",onClick:function(){e.props.onChange(t),e.setState({open:!1})}},t.replace("proto.",""))}))))}}]),t}(n.Component),Te=function(e,t){var o=Object(A.a)(e,2),n=o[0],a=(o[1],Object(A.a)(t,2)),r=a[0];a[1];return n<r?-1:n>r?1:0},Ae=function(e,t){var o=e.get(t);return void 0!==o?o.color:y.black},je=function(){var e=Object(M.a)(I.a.mark((function e(){var t,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(N).catch((function(e){return null}));case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return o=[],t.forEach((function(e){var t={name:e.name,url:e.url,options:new Map},n=new Map;"PhysState"===e.name?(Object.entries(e.options).forEach((function(e){var t=Object(A.a)(e,2),o=t[0],a=t[1];"POWER_ON"===a&&n.set(parseInt(o),a)})),Object.entries(e.options).forEach((function(e){var t=Object(A.a)(e,2),o=t[0],a=t[1];n.set(parseInt(o),a)}))):"RunState"===e.name?(Object.entries(e.options).forEach((function(e){var t=Object(A.a)(e,2),o=t[0],a=t[1];"SYNC"===a&&n.set(parseInt(o),a)})),Object.entries(e.options).forEach((function(e){var t=Object(A.a)(e,2),o=t[0],a=t[1];n.set(parseInt(o),a)}))):Object.entries(e.options).forEach((function(e){var t=Object(A.a)(e,2),o=t[0],a=t[1];n.set(parseInt(o),a)})),t.options=n,o.push(t)})),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xe=function(e){function t(e){var o;return Object(s.a)(this,t),(o=Object(i.a)(this,Object(u.a)(t).call(this,e))).pollingTimeout=void 0,o.reconnectTimeout=void 0,o.websocket=void 0,o.componentDidMount=function(){o.refetch()},o.componentDidUpdate=function(e,t){if(o.state.useWebSocket!==t.useWebSocket&&"RECONNECT"!==o.state.liveConnectionActive&&o.setState({liveConnectionActive:o.state.useWebSocket?"WEBSOCKET":"POLLING"}),o.state.updatingGraph!==t.updatingGraph&&void 0!==o.state.updatingGraph&&o.getGraph(o.state.updatingGraph),o.state.refreshRate!==t.refreshRate)switch(o.state.liveConnectionActive){case"POLLING":o.stopPolling(),o.startPolling();break;case"RECONNECT":o.stopReconnect(),o.startReconnect()}if(t.liveConnectionActive!==o.state.liveConnectionActive){switch(t.liveConnectionActive){case"POLLING":o.stopPolling();break;case"WEBSOCKET":"REFETCH"!==o.state.liveConnectionActive&&o.stopWebSocket();break;case"RECONNECT":o.stopReconnect()}switch(o.state.liveConnectionActive){case"POLLING":o.startPolling();break;case"WEBSOCKET":o.startWebSocket(o.refetch);break;case"RECONNECT":o.startReconnect();break;case"REFETCH":o.refetch()}}},o.handleRefreshChange=function(e){o.setState({refreshRate:e})},o.handleWebsocketChange=function(e){o.setState({useWebSocket:e})},o.stopPolling=function(){void 0!==o.pollingTimeout&&clearInterval(o.pollingTimeout),o.pollingTimeout=void 0},o.startPolling=function(){var e=o.state.refreshRate;e<.15&&(e=.15),o.pollingTimeout=setInterval(o.pollingFunction,1e3*e)},o.pollingFunction=function(){void 0!==o.state.cfgMaster.id?L(g,o.state.cfgMaster.id).then((function(e){if(null!==e.masterNode&&null!==e.computeNodes)if(null===o.validateNodes(o.state.cfgMaster,o.state.cfgNodes,e.masterNode,e.computeNodes)){var t=void 0,n=o.state.updatingGraph;void 0!==n&&(t=function(){o.getGraph(n)}),o.setFinalNodes(o.state.cfgMaster,o.state.cfgNodes,e.masterNode,e.computeNodes,t)}else o.setState({liveConnectionActive:"REFETCH"});else o.setState({liveConnectionActive:"RECONNECT"})})):o.setState({liveConnectionActive:"RECONNECT"})},o.stopWebSocket=function(){void 0!==o.websocket&&(o.websocket.onclose=function(){console.log("Closing WebSocket")},o.websocket.close(1e3)),o.websocket=void 0},o.startWebSocket=function(e){void 0===o.websocket?D(b).then((function(t){var n="ws://".concat(t.host,":").concat(t.port).concat(t.url);o.websocket=new WebSocket(n),o.websocket.onopen=function(){console.log("WebSocket Connected"),void 0!==o.websocket?(o.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:"STATE_CHANGE"})),o.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:"STATE_MUTATION"})),o.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:"DISCOVERY"})),e()):(console.warn("Websocket is somehow undefined"),o.setState({liveConnectionActive:"RECONNECT"}))},o.websocket.onmessage=function(e){var t=JSON.parse(e.data);null!==t&&o.handleWebSocketMessage(t)},o.websocket.onclose=function(e){console.warn("Websocket closed unexpectedly",e),o.setState({liveConnectionActive:"RECONNECT"})}})).catch((function(e){if("The operation is insecure."===e.message)return console.warn("Could not establish a websocket connection:",e),void o.setState({liveConnectionActive:"RECONNECT"});console.warn("Could not establish a websocket connection. Falling back to polling mode. Error:",e),o.setState({useWebSocket:!1})})):console.warn("Websocket already connected, refusing to create another")},o.handleWebSocketMessage=function(e){for(var t=Object(j.cloneDeep)(o.state.nodes),n=Object(j.cloneDeep)(o.state.dscNodes),a=!1,r=0;r<e.length;r++)if(1===e[r].type){if(e[r].data.includes("(CREATE)")||e[r].data.includes("(CFG_UPDATE")){console.log("Creation or update found. Close websocket and pull dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"});break}var c=e[r];if("/PhysState"===c.url||"/RunState"===c.url){var s=Q(c.nodeid),l=t.get(s),i=n.get(s);if(void 0===l||void 0===i){console.log("couldn't find node. Closing websocket and pulling dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"});break}switch(c.url){case"/PhysState":l.physState=c.value,i.physState=c.value,"POWER_OFF"===c.value?(l.runState="UNKNOWN",i.runState="UNKNOWN"):"PHYS_HANG"===c.value&&(l.runState="UNKNOWN",i.runState="UNKNOWN");break;case"/RunState":if("UNKNOWN"===c.value||"PHYS_UNKNOWN"!==l.physState&&"POWER_OFF"!==l.physState&&"PHYS_HANG"!==l.physState){l.runState=c.value,i.runState=c.value;break}console.log("Tried to change node's runstate while phystate is unknown. Closing websocket and pulling dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"})}a=!0}else if(c.url.includes("type.googleapis.com")){var u=Q(c.nodeid),d=t.get(u),p=n.get(u);if(void 0===d||void 0===p){console.log("couldn't find node. Closing websocket and pulling dsc and cfg nodes"),o.setState({liveConnectionActive:"REFETCH"});break}var f=Y(d,c);void 0!==f&&(d=f,a=!0);var h=Y(p,c);void 0!==h&&(p=h,a=!0)}}else void 0===o.state.updatingGraph||2!==e[r].type&&5!==e[r].type||e[r].nodeid!==X(o.state.updatingGraph).toLowerCase()||o.getGraph(o.state.updatingGraph);a&&o.setState({nodes:t,dscNodes:n})},o.setFinalNodes=function(e,t,n,a,r){var c=Object(j.cloneDeep)(t),s=new Map;c.forEach((function(e,t,o){var n=a.get(t);if(void 0!==n){var r=ne(e,n);void 0!==r.id&&s.set(r.id,r)}}));var l=new Map,i=new Map,u=new Map,d=Array.from(s.values()).sort(B);s=new Map;for(var p=0;p<d.length;p++){var f=d[p].id;if(void 0!==f){s.set(f,d[p]);var h=a.get(f),g=t.get(f);void 0!==h&&i.set(f,h),void 0!==g&&u.set(f,g),l.set(f,p)}}var m=e;m.physState=n.physState,m.runState=n.runState,o.setState({masterNode:m,nodes:s,cfgMaster:e,cfgNodes:u,dscMaster:n,dscNodes:i},r)},o.validateNodes=function(e,t,o,n){return void 0===e.id?Error("Missing cfg master"):0===Object.entries(o).length?Error("Missing dsc master"):t.size!==n.size?Error("cfg and dsc node lists are different sizes"):(t.forEach((function(e){return void 0===e.id?Error("A compute node id was undefined"):void 0===n.get(e.id)?Error("Could not find a cfg node in dsc node list"):void 0})),null)},o.stopReconnect=function(){void 0!==o.reconnectTimeout&&clearInterval(o.reconnectTimeout),o.reconnectTimeout=void 0},o.startReconnect=function(){console.log("Starting Reconnect");var e=o.state.refreshRate;e<.15&&(e=.15),o.reconnectTimeout=setInterval(o.reconnectFunction,1e3*e)},o.reconnectFunction=function(){U(m).then((function(e){null!==e.masterNode&&null!==e.computeNodes&&void 0!==e.masterNode.id&&o.setState({liveConnectionActive:"REFETCH"})}))},o.refetch=function(){console.log("Refetching"),V(m,g).then((function(e){null!==e.cfgMasterNode&&null!==e.cfgComputeNodes&&null!==e.dscMasterNode&&null!==e.dscComputeNodes?o.setFinalNodes(e.cfgMasterNode,e.cfgComputeNodes,e.dscMasterNode,e.dscComputeNodes,(function(){o.state.useWebSocket?o.setState({liveConnectionActive:"WEBSOCKET"}):o.setState({liveConnectionActive:"POLLING"})})):o.setState({liveConnectionActive:"RECONNECT"})})),je().then((function(e){null!==e&&o.setState({nodeStateOptions:e})}))},o.getGraph=function(e){D(E(X(e))).then((function(e){null===e?o.setState({liveConnectionActive:"RECONNECT"}):o.setState({graph:e})}))},o.startUpdatingGraph=function(e){o.setState({updatingGraph:e})},o.stopUpdatingGraph=function(){o.setState({updatingGraph:void 0,graph:void 0})},o.changeColorInfo=function(e){o.setState({colorInfo:e})},o.state={refreshRate:f,useWebSocket:h,masterNode:{},nodes:new Map,cfgNodes:new Map,cfgMaster:{},dscNodes:new Map,dscMaster:{},liveConnectionActive:"REFETCH",updatingGraph:void 0,graph:void 0,colorInfo:O},o}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(S.a,null,a.a.createElement(k,{refreshRate:this.state.refreshRate,handleRefreshChange:this.handleRefreshChange,useWebSocket:this.state.useWebSocket,handleWebsocketChange:this.handleWebsocketChange}),a.a.createElement(a.a.Fragment,null,a.a.createElement(w.a,{onchange:function(){console.log("route got clicked!")},exact:!0,path:"/",render:function(){return a.a.createElement(ue,{disconnected:"RECONNECT"===e.state.liveConnectionActive,cfgMasterNode:e.state.cfgMaster,dscMasterNode:e.state.dscMaster,cfgNodes:e.state.cfgNodes,dscNodes:e.state.dscNodes,opened:e.stopUpdatingGraph,colorInfo:e.state.colorInfo})}}),a.a.createElement(w.a,{path:"/node/:uuid",render:function(t){return a.a.createElement(ye,{disconnected:"RECONNECT"===e.state.liveConnectionActive,cfgNode:e.state.cfgMaster.id===Q(t.match.params.uuid)?e.state.cfgMaster:e.state.cfgNodes.get(Q(t.match.params.uuid)),dscNode:e.state.dscMaster.id===Q(t.match.params.uuid)?e.state.dscMaster:e.state.dscNodes.get(Q(t.match.params.uuid)),opened:function(){Q(t.match.params.uuid)!==e.state.masterNode.id&&e.startUpdatingGraph(Q(t.match.params.uuid))},graph:e.state.graph,colorInfo:e.state.colorInfo})}}),a.a.createElement(w.a,{exact:!0,path:"/settings",render:function(){return a.a.createElement(Se,{nodeStateOptions:e.state.nodeStateOptions,currentColorConfig:e.state.colorInfo,changeColorInfo:e.changeColorInfo})}})))}}]),t}(n.Component);c.a.render(a.a.createElement(xe,null),document.getElementById("root"))},71:function(e,t,o){}},[[112,1,2]]]);
//# sourceMappingURL=main.0f1cf2c0.chunk.js.map