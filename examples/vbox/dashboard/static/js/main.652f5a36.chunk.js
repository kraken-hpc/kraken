(this["webpackJsonpkraken-dashboard"]=this["webpackJsonpkraken-dashboard"]||[]).push([[0],{21:function(e,t,n){},27:function(e,t,n){e.exports=n(41)},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(24),s=n.n(r),c=(n(21),n(5)),i=n(10),l=n(7),d=n(6),u=n(8),p=(n(32),n(33),n(34),n(35),"192.168.57.10:3141"),h=.4,m=!0,g="http://".concat(p,"/dsc/nodes"),v="http://".concat(p,"/cfg/nodes"),f="http://".concat(p,"/dsc/node"),N="http://".concat(p,"/cfg/node"),b=("http://".concat(p,"/graph/json"),"http://".concat(p,"/ws")),E=function(e){return"http://".concat(p,"/graph/node/").concat(e,"/json")},y={red:window.getComputedStyle(document.documentElement).getPropertyValue("--red"),purple:window.getComputedStyle(document.documentElement).getPropertyValue("--purple"),grey:window.getComputedStyle(document.documentElement).getPropertyValue("--grey"),yellow:window.getComputedStyle(document.documentElement).getPropertyValue("--yellow"),blue:window.getComputedStyle(document.documentElement).getPropertyValue("--blue"),green:window.getComputedStyle(document.documentElement).getPropertyValue("--green"),black:window.getComputedStyle(document.documentElement).getPropertyValue("--black"),titleRed:window.getComputedStyle(document.documentElement).getPropertyValue("--title-red")},C=n(11),S=n(12);function k(e){return o.a.createElement("div",{className:"header"},o.a.createElement(C.b,{to:"/",className:"header-link"},o.a.createElement("div",{className:"header-text"},"Kraken")),o.a.createElement(w,{refreshRate:e.refreshRate,handleRefreshChange:e.handleRefreshChange,useWebSocket:e.useWebSocket,handleWebsocketChange:e.handleWebsocketChange}))}var w=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={menuOpen:!1},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"modalToggle",value:function(){this.setState({menuOpen:!this.state.menuOpen})}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement("svg",{onClick:function(){return e.modalToggle()},className:"settings",id:"settings-button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},o.a.createElement("path",{fill:"none",d:"M0 0h20v20H0V0z"}),o.a.createElement("path",{fill:y.titleRed,d:"M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"})),o.a.createElement(O,{menuOpen:this.state.menuOpen,refreshRate:this.props.refreshRate,handleRefreshChange:this.props.handleRefreshChange,useWebSocket:this.props.useWebSocket,handleWebsocketChange:this.props.handleWebsocketChange}))}}]),t}(o.a.Component),O=function(e){function t(e){var n;Object(c.a)(this,t);return(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={topHeight:"7rem",bottomHeight:"8rem",style:{opacity:n.props.menuOpen?100:0,visibility:n.props.menuOpen?"visible":"hidden",top:n.props.menuOpen?"7rem":"8rem"}},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){e.menuOpen!==this.props.menuOpen&&this.setState({style:{opacity:this.props.menuOpen?100:0,visibility:this.props.menuOpen?"visible":"hidden",top:this.props.menuOpen?this.state.topHeight:this.state.bottomHeight}})}},{key:"render",value:function(){var e=this;return o.a.createElement("form",{className:"settings",id:"settings-modal",style:this.state.style},o.a.createElement("div",{className:"settings-row"},o.a.createElement("label",null,"Reconnect Rate:"),o.a.createElement("input",{id:"slider",name:"refreshRate",type:"range",min:"0.15",max:"2",value:this.props.refreshRate,onChange:function(t){e.props.handleRefreshChange(parseFloat(t.target.value))},step:".05"}),o.a.createElement("div",{id:"slider-output"},this.props.refreshRate)),o.a.createElement("div",{className:"settings-row"},o.a.createElement("label",null,"Websocket:"),o.a.createElement("input",{style:{margin:"auto 7px"},name:"websocket",type:"checkbox",checked:this.props.useWebSocket,onChange:function(){e.props.handleWebsocketChange(!e.props.useWebSocket)}})))}}]),t}(o.a.Component);function R(){return o.a.createElement("div",{className:"legend"},o.a.createElement("div",{className:"legend-title"},"Legend"),o.a.createElement("div",{className:"row",id:"first-row"},o.a.createElement("div",{className:"value",id:"phys-text"},"Phys"),o.a.createElement("div",{className:"square",style:{borderTopColor:y.grey,borderRightColor:y.black,borderBottomColor:y.black,borderLeftColor:y.grey}}),o.a.createElement("div",{className:"value",id:"run-text"},"Run")),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"square",style:{borderColor:y.yellow}}),o.a.createElement("div",{className:"value"},"State Unknown")),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"square",style:{borderColor:y.grey}}),o.a.createElement("div",{className:"value"},"Power Off")),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"square",style:{borderColor:y.blue}}),o.a.createElement("div",{className:"value"},"Initializing")),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"square",style:{borderColor:y.green}}),o.a.createElement("div",{className:"value"},"Power On / Sync")),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"square",style:{borderColor:y.purple}}),o.a.createElement("div",{className:"value"},"Hang")),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"square",style:{borderColor:y.red}}),o.a.createElement("div",{className:"value"},"Error")))}var W=n(3),x=n.n(W),T=n(14),j=function(){var e=Object(T.a)(x.a.mark((function e(t){var n,a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).catch((function(e){return null}));case 2:if(null===(n=e.sent)){e.next=10;break}return e.next=6,n.json();case 6:return a=e.sent,e.abrupt("return",a.nodes);case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(T.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).catch((function(e){return null}));case 2:if(null===(n=e.sent)){e.next=7;break}return e.abrupt("return",n.json());case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(T.a)(x.a.mark((function e(t){var n,a,o,r,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Map,a={},e.next=4,j(t);case 4:if(null!==(o=e.sent)){e.next=9;break}return e.abrupt("return",{masterNode:null,computeNodes:null});case 9:for(r=0;r<o.length;r++)null===o[r].parentId||void 0===o[r].parentId?a=o[r]:void 0!==(s=o[r].id)&&n.set(s,o[r]);case 10:return e.abrupt("return",{masterNode:a,computeNodes:n});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(T.a)(x.a.mark((function e(t,n){var a,o,r,s,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Map,o={},e.next=4,j(t);case 4:if(null!==(r=e.sent)){e.next=9;break}return e.abrupt("return",{masterNode:null,computeNodes:null});case 9:for(s=0;s<r.length;s++)r[s].id===n?o=r[s]:void 0!==(c=r[s].id)&&a.set(c,r[s]);case 10:return e.abrupt("return",{masterNode:o,computeNodes:a});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=function(e,t){if(void 0===e.nodename&&void 0===t.nodename)return 0;if(void 0===e.nodename)return-1;if(void 0===t.nodename)return 1;var n=e.nodename.match(/(\d*)/g),a=t.nodename.match(/(\d*)/g),o=void 0,r=void 0,s=void 0,c=void 0;return null!==n&&(o=parseInt(n[1]),r=parseInt(n[3])),null!==a&&(s=parseInt(a[1]),c=parseInt(a[3])),void 0!==o&&void 0!==s&&o>s?1:void 0!==o&&void 0!==s&&o<s?-1:void 0!==r&&void 0!==c&&r>c?1:void 0!==r&&void 0!==c&&r<c?-1:e.nodename.localeCompare(t.nodename)},I=function(e){return"PHYS_ERROR"===e||"ERROR"===e||"POWER_CYCLE"===e?y.red:"PHYS_HANG"===e?y.purple:"POWER_OFF"===e?y.grey:"PHYS_UNKNOWN"===e||"UNKNOWN"===e?y.yellow:"INIT"===e?y.blue:"SYNC"===e||"POWER_ON"===e?y.green:y.yellow},U=function(e){for(var t=atob(e),n="",a=0;a<t.length;a++){var o=t.charCodeAt(a).toString(16);n+=2===o.length?o:"0"+o}return n.toUpperCase()},G=function(e){for(var t=atob(e),n="",a=0;a<t.length;a++){var o=t.charCodeAt(a).toString(10);n+=0===a?o:"."+o}return n},L=function(e){if(void 0!==e){var t=U(e);return t=t.replace(/(.{8})(.{4})(.{4})(.{4})(.{10})/,"$1-$2-$3-$4-$5")}return""},H=function(e){return function(e){var t=e.match(/.{1,2}/g),n="";if(null!==t)for(var a=0;a<t.length;a++)n+=String.fromCharCode(parseInt(t[a],16));return btoa(n)}(e.replace(/-/g,""))},B=function(e,t){switch(!0){case e.includes("ip"):return G(t);case e.includes("mac"):return function(e){var t=U(e);return t=t.replace(/(.{2})(.{2})(.{2})(.{2})(.{2})(.{2})/,"$1:$2:$3:$4:$5:$6")}(t);case e.includes("subnet"):return G(t);default:return t}},K=function(e){return e.replace("type.googleapis.com/proto.","")},D=function(e,t,n){return fetch(e,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)}).then((function(e){return e.json()})).then(n).catch((function(e){return console.error("putNode error:",e)}))},z=function(e){var t=I(e.data.physState),n=L(e.data.id);return o.a.createElement(C.b,{className:"master-square shadow animate",style:{backgroundColor:t},to:"node/".concat(n)},"Master")},V=function(e){void 0===e.data.physState&&(e.data.physState="UNKNOWN"),void 0===e.data.runState&&(e.data.runState="UNKNOWN");var t=e.data.nodename,n=I(e.data.physState),a=I(e.data.runState),r=L(e.data.id),s="Name: ".concat(t,"\nUUID: ").concat(r,"\nPhysical State: ").concat(e.data.physState,"\nRun State: ").concat(e.data.runState);return o.a.createElement(C.b,{"data-popup":s,className:"square",style:{borderTopColor:n,borderRightColor:a,borderBottomColor:a,borderLeftColor:n},to:"node/".concat(r)})},$=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).stateCount=function(e){var t=0,n=0,a=0;return e.forEach((function(e){switch(e.runState){case"UNKNOWN":t++;break;case"INIT":n++;break;case"SYNC":a++;break;default:t++}})),{unknownCount:t,initCount:n,syncCount:a}},n.componentDidMount=function(){n.props.opened()},n.render=function(){var e=n.stateCount(n.props.nodes);return o.a.createElement(o.a.Fragment,null,n.props.disconnected&&o.a.createElement("h2",{style:{textAlign:"center",fontFamily:"Arial",color:"maroon"}},"Disconnected From Kraken"),0===n.props.nodes.size&&void 0===n.props.masterNode.id?o.a.createElement("h3",{style:{fontFamily:"Arial"}},"Loading..."):o.a.createElement("div",{className:"cluster"},o.a.createElement(z,{data:n.props.masterNode}),o.a.createElement("div",{className:"cluster-nodelist"},Array.from(n.props.nodes.values()).map((function(e){return o.a.createElement(V,{data:e,key:e.id})})))),o.a.createElement("div",{className:"counts-area"},o.a.createElement("div",{className:"counts"},"Unknown: ",e.unknownCount),o.a.createElement("div",{className:"counts"},"Init: ",e.initCount),o.a.createElement("div",{className:"counts"},"Sync: ",e.syncCount)))},n}return Object(u.a)(t,e),t}(a.Component);function _(e){return o.a.createElement("div",{style:{textAlign:"center",display:"inline-block"}},o.a.createElement(R,null),o.a.createElement("div",{className:"node-area"},o.a.createElement($,{opened:e.opened,disconnected:e.disconnected,masterNode:e.masterNode,nodes:e.nodes})))}var q=function(e){var t=I(e.dscNode.physState),n=I(e.dscNode.runState);return o.a.createElement("div",{className:"large-square",style:{borderTopColor:t,borderRightColor:n,borderBottomColor:n,borderLeftColor:t}})},Y=function(e){var t=void 0!==e.dscNode.runState?e.dscNode.runState:"",n=void 0!==e.cfgNode.runState?e.cfgNode.runState:"",a=void 0!==e.dscNode.physState?e.dscNode.physState:"",r=void 0!==e.cfgNode.physState?e.cfgNode.physState:"",s=L(e.cfgNode.id),c="";null!==e.cfgNode.parentId&&void 0!==e.cfgNode.parentId?c=L(e.cfgNode.parentId):e.cfgNode.nodename="Master";var i=void 0!==e.cfgNode.arch?e.cfgNode.arch:"",l=void 0!==e.cfgNode.platform?e.cfgNode.platform:"",d=Z("Node ID",0,s),u=""!==c?Z("Parent ID",0,c):o.a.createElement(o.a.Fragment,null),p=Z("Physical State",0,"".concat(a," / ").concat(r)),h=Z("Run State",0,"".concat(t," / ").concat(n)),m=""!==i?Z("Architecture",0,i):o.a.createElement(o.a.Fragment,null),g=""!==l?Z("Platform",0,l):o.a.createElement(o.a.Fragment,null),v=[],f=[];if(void 0!==e.cfgNode.extensions)for(var N=0;N<e.cfgNode.extensions.length;N++)v.push(e.cfgNode.extensions[N]);v.sort((function(e,t){return K(e["@type"])<K(t["@type"])?-1:K(e["@type"])>K(t["@type"])?1:0}));for(var b=0;b<v.length;b++)Object.keys(v[b]).length>1&&f.push(o.a.createElement(J,{extension:v[b],key:b}));var E=[],y=[];if(void 0!==e.dscNode.services)for(var C=0;C<e.dscNode.services.length;C++)E.push(e.dscNode.services[C]);E.sort((function(e,t){return K(e.id)<K(t.id)?-1:K(e.id)>K(t.id)?1:0}));for(var S=0;S<E.length;S++)Object.keys(E[S]).length>1&&y.push(o.a.createElement(X,{service:E[S],key:S}));return o.a.createElement("div",{className:"node-detail"},o.a.createElement("h1",{className:"node-title"},e.cfgNode.nodename),o.a.createElement("div",{className:"non-bordered-detail"},d,u,p,h,m,g),f.length>0?o.a.createElement("h2",null,"Extensions:"):o.a.createElement(o.a.Fragment,null),f,y.length>0?o.a.createElement("h2",null,"Services:"):o.a.createElement(o.a.Fragment,null),y)},J=function(e){for(var t=K(e.extension["@type"]),n=[],a=0,r=Object.keys(e.extension);a<r.length;a++){var s=r[a];"@type"!==s&&n.push(Q(e.extension[s],s,0))}return o.a.createElement("div",{className:"bordered-detail"},o.a.createElement("div",{className:"info-title"},t),n)},X=function(e){for(var t=K(e.service.id),n=[],a=0,r=Object.keys(e.service);a<r.length;a++){var s=r[a];"id"!==s&&n.push(Q(e.service[s],s,0))}return o.a.createElement("div",{className:"bordered-detail"},o.a.createElement("div",{className:"info-title"},t),n)},Q=function e(t,n,a){a++;var o=[];if(Array.isArray(t)){o.push(Z(n,a));for(var r=0;r<t.length;r++)o.push(e(t[r],r,a))}else if("object"===typeof t){o.push(Z(n,a));for(var s=0,c=Object.keys(t);s<c.length;s++){var i=c[s];o.push(e(t[i],i,a))}}else t===Boolean?o.push(Z(n,a,t.toString())):o.push(Z(n,a,B(n.toString(),t)));return o},Z=function(e,t,n){var a=(15*(t-1)).toString()+"px";return o.a.createElement("div",{style:{paddingLeft:a},className:"node-view-row",key:e},o.a.createElement("span",{className:"node-view-key"},e,":"),o.a.createElement("span",{className:"node-view-value"},n))},ee=function(e){return o.a.createElement("div",{className:"actions-area",style:{display:void 0===e.cfgNode.parentId?"none":""}},o.a.createElement("div",{className:"button green",onClick:function(){var t;(t=e.cfgNode).runState="SYNC",t.physState="POWER_ON",D(N,t)}},"Power On"),o.a.createElement("div",{className:"button red",onClick:function(){!function(e,t){if(e.physState="POWER_OFF",e.runState="UNKNOWN",void 0!==e.extensions)for(var n=0;n<e.extensions.length;n++)"type.googleapis.com/proto.PXE"===e.extensions[n]["@type"]?e.extensions[n].state="NONE":"type.googleapis.com/proto.RPi3"===e.extensions[n]["@type"]&&(e.extensions[n].pxe="NONE");if(t.runState="UNKNOWN",void 0!==t.extensions)for(var a=0;a<t.extensions.length;a++)"type.googleapis.com/proto.PXE"===t.extensions[a]["@type"]?t.extensions[a].state="NONE":"type.googleapis.com/proto.RPi3"===t.extensions[a]["@type"]&&(t.extensions[a].pxe="NONE");D(f,t,(function(){D(N,e)}))}(e.cfgNode,e.dscNode)}},"Power Off"),o.a.createElement("div",{className:"button purple",id:"graph-button",onClick:e.graphToggle},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100",height:"38",viewBox:"0 0 24 20"},o.a.createElement("path",{fill:"None",d:"M0 0h24v24H0V0z"}),o.a.createElement("path",{fill:"white",d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"}))))},te=n(16),ne=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).appRef=void 0,n.appRef=Object(a.createRef)();for(var o=e.graph.nodes,r=0;r<o.length;r++){var s={border:o[r].color.border,background:o[r].color.background};o[r].color.highlight=s,o[r].borderWidth=2}var i={nodes:new te.a.DataSet(o),edges:new te.a.DataSet(e.graph.edges)};return n.state={data:i,options:{edges:{arrows:{to:{enabled:!0,scaleFactor:1.5}},color:{inherit:!1},width:4},physics:{enabled:!0,barnesHut:{gravitationalConstant:-5e4}},height:"100%",width:"100%"},style:{opacity:n.props.graphOpen?100:0,visibility:n.props.graphOpen?"visible":"hidden"}},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){void 0!==this.appRef&&new te.a.Network(this.appRef.current,this.state.data,this.state.options).fit(this.state.options)}},{key:"componentDidUpdate",value:function(e){if(this.props.graphOpen!==e.graphOpen&&this.setState({style:{opacity:this.props.graphOpen?100:0,visibility:this.props.graphOpen?"visible":"hidden"}}),this.props.graph!==e.graph){for(var t=this.state.data,n=this.props.graph.nodes,a=0;a<n.length;a++){var o={border:n[a].color.border,background:n[a].color.background};n[a].color.highlight=o,n[a].borderWidth=2}t.nodes.update(n),t.edges.update(this.props.graph.edges),this.forceUpdate()}}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{style:this.state.style,className:"graph-area"},o.a.createElement("div",{className:"close-button",onClick:function(){e.props.graphToggle()}},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 24 24"},o.a.createElement("path",{fill:"None",d:"M0 0h24v24H0V0z"}),o.a.createElement("path",{fill:y.grey,d:"M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"}))),o.a.createElement("div",{className:"node-graph",ref:this.appRef}))}}]),t}(a.Component),ae=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).componentDidMount=function(){n.props.opened()},n.graphToggle=function(){n.setState({graphOpen:!n.state.graphOpen})},n.state={graphOpen:!1},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.props.disconnected&&o.a.createElement("h2",{style:{textAlign:"center",fontFamily:"Arial",color:"maroon"}},"Disconnected From Kraken"),void 0===this.props.cfgNode||void 0===this.props.dscNode?o.a.createElement("h3",{style:{fontFamily:"Arial"}},"Node Does Not Exist"):o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"node-view"},o.a.createElement(q,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode}),o.a.createElement(Y,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode}),o.a.createElement(ee,{dscNode:this.props.dscNode,cfgNode:this.props.cfgNode,graphToggle:this.graphToggle})),void 0!==this.props.graph&&0!==Object.keys(this.props.graph).length&&o.a.createElement(ne,{graph:this.props.graph,graphOpen:this.state.graphOpen,graphToggle:this.graphToggle})))}}]),t}(a.Component),oe=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).pollingTimeout=void 0,n.reconnectTimeout=void 0,n.websocket=void 0,n.componentDidMount=function(){n.refetch()},n.componentDidUpdate=function(e,t){if(n.state.useWebSocket!==t.useWebSocket&&"RECONNECT"!==n.state.liveConnectionActive&&n.setState({liveConnectionActive:n.state.useWebSocket?"WEBSOCKET":"POLLING"}),n.state.updatingGraph!==t.updatingGraph&&void 0!==n.state.updatingGraph&&n.getGraph(n.state.updatingGraph),n.state.refreshRate!==t.refreshRate)switch(n.state.liveConnectionActive){case"POLLING":n.stopPolling(),n.startPolling();break;case"RECONNECT":n.stopReconnect(),n.startReconnect()}if(t.liveConnectionActive!==n.state.liveConnectionActive){switch(t.liveConnectionActive){case"POLLING":n.stopPolling();break;case"WEBSOCKET":n.stopWebSocket();break;case"RECONNECT":n.stopReconnect()}switch(n.state.liveConnectionActive){case"POLLING":n.startPolling();break;case"WEBSOCKET":n.startWebSocket();break;case"RECONNECT":n.startReconnect();break;case"REFETCH":n.refetch()}}},n.handleRefreshChange=function(e){n.setState({refreshRate:e})},n.handleWebsocketChange=function(e){n.setState({useWebSocket:e})},n.stopPolling=function(){void 0!==n.pollingTimeout&&clearInterval(n.pollingTimeout),n.pollingTimeout=void 0},n.startPolling=function(){var e=n.state.refreshRate;e<.15&&(e=.15),n.pollingTimeout=setInterval(n.pollingFunction,1e3*e)},n.pollingFunction=function(){void 0!==n.state.cfgMaster.id?F(g,n.state.cfgMaster.id).then((function(e){if(null!==e.masterNode&&null!==e.computeNodes)if(null===n.validateNodes(n.state.cfgMaster,n.state.cfgNodes,e.masterNode,e.computeNodes)){var t=void 0,a=n.state.updatingGraph;void 0!==a&&(t=function(){n.getGraph(a)}),n.setFinalNodes(n.state.cfgMaster,n.state.cfgNodes,e.masterNode,e.computeNodes,t)}else n.setState({liveConnectionActive:"REFETCH"});else n.setState({liveConnectionActive:"RECONNECT"})})):n.setState({liveConnectionActive:"RECONNECT"})},n.stopWebSocket=function(){void 0!==n.websocket&&(n.websocket.onclose=function(){console.log("Closing WebSocket")},n.websocket.close(1e3)),n.websocket=void 0},n.startWebSocket=function(){void 0===n.websocket?P(b).then((function(e){var t="ws://".concat(e.websocket.host,":").concat(e.websocket.port).concat(e.websocket.url);n.websocket=new WebSocket(t),n.websocket.onopen=function(){console.log("WebSocket Connected"),void 0!==n.websocket?(n.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:1})),n.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:2})),n.websocket.send(JSON.stringify({command:"SUBSCRIBE",type:5}))):(console.warn("Websocket is somehow undefined"),n.setState({liveConnectionActive:"RECONNECT"}))},n.websocket.onmessage=function(e){var t=JSON.parse(e.data);console.log("websocket received this message:",t),null!==t&&n.handleWebSocketMessage(t)},n.websocket.onclose=function(){console.warn("Websocket closed unexpectedly"),n.setState({liveConnectionActive:"RECONNECT"})}})).catch((function(e){console.warn("Could not establish a websocket connection. Falling back to polling mode"),n.setState({useWebSocket:!1})})):console.warn("Websocket already connected, refusing to create another")},n.handleWebSocketMessage=function(e){for(var t=new Map(n.state.nodes),a=new Map(n.state.dscNodes),o=!1,r=0;r<e.length;r++)if(1===e[r].type){if(e[r].data.includes("(CREATE)")||e[r].data.includes("(CFG_UPDATE")){console.log("Creation or update found. Close websocket and pull dsc and cfg nodes"),n.setState({liveConnectionActive:"REFETCH"});break}var s=e[r];if("/PhysState"===s.url||"/RunState"===s.url){var c=H(s.nodeid),i=t.get(c),l=a.get(c);if(void 0===i||void 0===l){console.log("couldn't find node. Closing websocket and pulling dsc and cfg nodes"),n.setState({liveConnectionActive:"REFETCH"});break}switch(s.url){case"/PhysState":i.physState=s.value,l.physState=s.value,"POWER_OFF"===s.value?(i.runState="UNKNOWN",l.runState="UNKNOWN"):"PHYS_HANG"===s.value&&(i.runState="UNKNOWN",l.runState="UNKNOWN");break;case"/RunState":i.runState=s.value,l.runState=s.value}o=!0}}else void 0===n.state.updatingGraph||2!==e[r].type&&5!==e[r].type||e[r].nodeid!==L(n.state.updatingGraph).toLowerCase()||n.getGraph(n.state.updatingGraph);o&&n.setState({nodes:t,dscNodes:a})},n.setFinalNodes=function(e,t,a,o,r){var s=new Map(t);s.forEach((function(e,t,n){var a=o.get(t);void 0!==a&&(e.physState=a.physState,e.runState=a.runState)}));var c=Array.from(s.values()).sort(M);s=new Map;for(var i=0;i<c.length;i++){var l=c[i].id;void 0!==l&&s.set(l,c[i])}var d=e;d.physState=a.physState,d.runState=a.runState,n.setState({masterNode:d,nodes:s,cfgMaster:e,cfgNodes:t,dscMaster:a,dscNodes:o},r)},n.validateNodes=function(e,t,n,a){return void 0===e.id?Error("Missing cfg master"):0===Object.entries(n).length?Error("Missing dsc master"):t.size!==a.size?Error("cfg and dsc node lists are different sizes"):(t.forEach((function(e){return void 0===e.id?Error("A compute node id was undefined"):void 0===a.get(e.id)?Error("Could not find a cfg node in dsc node list"):void 0})),null)},n.stopReconnect=function(){void 0!==n.reconnectTimeout&&clearInterval(n.reconnectTimeout),n.reconnectTimeout=void 0},n.startReconnect=function(){console.log("Starting Reconnect");var e=n.state.refreshRate;e<.15&&(e=.15),n.reconnectTimeout=setInterval(n.reconnectFunction,1e3*e)},n.reconnectFunction=function(){A(v).then((function(e){null!==e.masterNode&&null!==e.computeNodes&&void 0!==e.masterNode.id&&n.setState({liveConnectionActive:"REFETCH"})}))},n.refetch=function(){console.log("Refetching"),A(v).then((function(e){null!==e.masterNode&&null!==e.computeNodes&&void 0!==e.masterNode.id?F(g,e.masterNode.id).then((function(t){null!==t.masterNode&&null!==t.computeNodes&&null!==e.masterNode&&null!==e.computeNodes?n.setFinalNodes(e.masterNode,e.computeNodes,t.masterNode,t.computeNodes,(function(){n.state.useWebSocket?n.setState({liveConnectionActive:"WEBSOCKET"}):n.setState({liveConnectionActive:"POLLING"})})):n.setState({liveConnectionActive:"RECONNECT"})})):n.setState({liveConnectionActive:"RECONNECT"})}))},n.getGraph=function(e){P(E(L(e))).then((function(e){null===e?n.setState({liveConnectionActive:"RECONNECT"}):n.setState({graph:e})}))},n.startUpdatingGraph=function(e){n.setState({updatingGraph:e})},n.stopUpdatingGraph=function(){n.setState({updatingGraph:void 0,graph:void 0})},n.state={refreshRate:h,useWebSocket:m,masterNode:{},nodes:new Map,cfgNodes:new Map,cfgMaster:{},dscNodes:new Map,dscMaster:{},liveConnectionActive:"REFETCH",updatingGraph:void 0,graph:void 0},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(C.a,null,o.a.createElement(k,{refreshRate:this.state.refreshRate,handleRefreshChange:this.handleRefreshChange,useWebSocket:this.state.useWebSocket,handleWebsocketChange:this.handleWebsocketChange}),o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,{onchange:function(){console.log("route got clicked!")},exact:!0,path:"/",render:function(){return o.a.createElement(_,{disconnected:"RECONNECT"===e.state.liveConnectionActive,masterNode:e.state.masterNode,nodes:e.state.nodes,opened:e.stopUpdatingGraph})}}),o.a.createElement(S.a,{path:"/node/:uuid",render:function(t){return o.a.createElement(ae,{disconnected:"RECONNECT"===e.state.liveConnectionActive,cfgNode:e.state.cfgMaster.id===H(t.match.params.uuid)?e.state.cfgMaster:e.state.cfgNodes.get(H(t.match.params.uuid)),dscNode:e.state.dscMaster.id===H(t.match.params.uuid)?e.state.dscMaster:e.state.dscNodes.get(H(t.match.params.uuid)),opened:function(){e.startUpdatingGraph(H(t.match.params.uuid))},graph:e.state.graph})}})))}}]),t}(a.Component);s.a.render(o.a.createElement(oe,null),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.652f5a36.chunk.js.map